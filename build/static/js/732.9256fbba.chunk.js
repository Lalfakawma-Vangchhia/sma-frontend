"use strict";(self.webpackChunkautomation_dashboard=self.webpackChunkautomation_dashboard||[]).push([[732],{732:(e,s,t)=>{t.r(s),t.d(s,{default:()=>p});var a=t(43),i=t(615),l=t(726),o=t(16),n=t(471),r=t(860),c=t(579);const d=function(e){var s,t;let{selectedAccount:o,onClose:d}=e;const{addNotification:u}=(0,n.E)(),[m,g]=(0,a.useState)({promptTemplate:"",customStrategyTemplate:"",brandName:"",hookIdea:"",features:"",location:"",phone:"",website:"",callToAction:"",imagePrompt:"",startDate:"",endDate:"",frequency:"daily",customCron:"",timeSlot:"09:00"}),[h,p]=(0,a.useState)([]),[x,v]=(0,a.useState)([]),[f,j]=(0,a.useState)(null),[y,b]=(0,a.useState)("photo"),[w,N]=(0,a.useState)(2),[k,C]=(0,a.useState)(new Date),[S,I]=(0,a.useState)(!1),[_,P]=(0,a.useState)(0),[D,A]=(0,a.useState)(null),[F,E]=(0,a.useState)(null),[T,B]=(0,a.useState)(null),[U,G]=(0,a.useState)(null),[$]=(0,a.useState)([]),R=(0,i.Zp)(),[W]=(0,a.useState)([{id:1,name:"Daily Inspiration",prompt:"Share an inspiring quote or motivational message for your Instagram audience"},{id:2,name:"Product Showcase",prompt:"Highlight your best products with engaging descriptions and hashtags"},{id:3,name:"Behind the Scenes",prompt:"Share behind-the-scenes content about your business or team"},{id:4,name:"Customer Spotlight",prompt:"Feature customer testimonials or success stories"},{id:5,name:"Industry Tips",prompt:"Share valuable tips and insights related to your industry"},{id:6,name:"Lifestyle Content",prompt:"Share lifestyle content that resonates with your audience"},{id:7,name:"User Generated Content",prompt:"Repost and credit amazing content from your community"},{id:8,name:"Custom",prompt:"custom"}]),M=(0,a.useRef)(null),L=(0,a.useRef)({});(0,a.useEffect)(()=>{m.startDate&&m.frequency&&z()},[m.startDate,m.endDate,m.frequency,m.timeSlot]);const z=()=>{if(!m.startDate)return;const e=m.startDate.split("-"),s=new Date(parseInt(e[0]),parseInt(e[1])-1,parseInt(e[2]));let t=null;if(m.endDate){const e=m.endDate.split("-");t=new Date(parseInt(e[0]),parseInt(e[1])-1,parseInt(e[2]))}const a=[];let i=new Date(s),l=0,o=0;if(t)for(;l<30&&o<30&&!(t&&i>t);){if(i>new Date(Date.now()+2592e6))break;let e=!1;switch(m.frequency){case"daily":case"custom":default:e=!0;break;case"weekly":e=i.getDay()===s.getDay();break;case"monthly":e=i.getDate()===s.getDate()}if(e){const e=`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}`;a.push({id:`row-${o}`,caption:"",mediaFile:null,mediaPreview:null,thumbnailFile:null,thumbnailPreview:null,postType:y.toLowerCase(),carouselImageCount:w,carouselImages:[],scheduledDate:e,scheduledTime:m.timeSlot,status:"draft",isSelected:!1,carouselUploading:!1}),o++}if(t&&i.getTime()===t.getTime())break;i.setDate(i.getDate()+1),l++}else{const e=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`;a.push({id:"row-0",caption:"",mediaFile:null,mediaPreview:null,thumbnailFile:null,thumbnailPreview:null,postType:y.toLowerCase(),carouselImageCount:w,carouselImages:[],scheduledDate:e,scheduledTime:m.timeSlot,status:"draft",isSelected:!1,carouselUploading:!1})}p(a)},O=(e,s)=>{g(t=>{const a={...t,[e]:s};return"startDate"===e&&t.endDate&&s>t.endDate&&(a.endDate=""),a}),"promptTemplate"===e&&s&&"custom"!==s&&p(e=>e.map(e=>({...e,caption:s})))},V=e=>{b(e),p(s=>s.map(s=>({...s,postType:e.toLowerCase(),carouselImageCount:"carousel"===e?w:null,carouselImages:"carousel"===e&&s.carouselImages||[],mediaFile:"carousel"===e?null:s.mediaFile,mediaPreview:"carousel"===e?null:s.mediaPreview,thumbnailFile:"reel"===e?s.thumbnailFile:null,thumbnailPreview:"reel"===e?s.thumbnailPreview:null})))},q=(e,s,t)=>{p(a=>a.map(a=>a.id===e?{...a,[s]:"postType"===s?t.toLowerCase():t,status:(()=>{if("postType"===s&&"carousel"===t.toLowerCase())return"draft";if("carousel"===a.postType){const e=(a.caption||"").trim(),s=(a.carouselImages||[]).length>=2;return e&&s?"ready":"draft"}if("caption"===s||"mediaFile"===s||"mediaPreview"===s){const e="caption"===s?t.trim():(a.caption||"").trim(),i="mediaFile"===s?t:a.mediaFile||a.mediaPreview;return e&&i?"ready":"draft"}return a.status})()}:a))},H=e=>{const s=h.find(s=>s.id===e);s&&(s.mediaPreview||s.mediaFile)&&E(s)},K=async(e,s)=>{const t=s.target.files[0];if(t)if(t.type.startsWith("image/")){p(s=>s.map(s=>s.id===e?{...s,thumbnailUploading:!0}:s));try{console.log(`\ud83d\udce4 Uploading thumbnail for row ${e}: ${t.name}`);const s=await l.A.uploadThumbnailToCloudinary(t);s&&s.success&&s.data&&s.data.url?(console.log(`\u2705 Thumbnail uploaded successfully: ${s.data.url}`),p(t=>t.map(t=>t.id===e?{...t,thumbnailFile:null,thumbnailPreview:s.data.url,thumbnailUrl:s.data.url,thumbnailUploading:!1}:t)),alert("Thumbnail uploaded successfully! It will be optimized for Instagram reel cover image requirements.")):(console.error("\u274c Failed to upload thumbnail:",s),alert("Failed to upload thumbnail. Please try again."),p(s=>s.map(s=>s.id===e?{...s,thumbnailUploading:!1}:s)))}catch(a){console.error("Error uploading thumbnail:",a),alert(`Failed to upload thumbnail: ${a.message}`),p(s=>s.map(s=>s.id===e?{...s,thumbnailUploading:!1}:s))}}else alert("Please select an image file for the thumbnail.")},Y=e=>{p(s=>s.map(s=>s.id===e?{...s,mediaFile:null,mediaPreview:null,thumbnailFile:null,thumbnailPreview:null,carouselImages:"carousel"===s.postType?[]:null,status:((s.caption||"").trim(),"draft")}:s))},J=(e,s)=>{const t=h.find(s=>s.id===e);t&&t.carouselImages&&t.carouselImages[s]&&E({...t,mediaPreview:t.carouselImages[s],mediaType:"carousel-image",imageIndex:s,isNested:!!T})},Q=(e,s)=>{p(t=>t.map(t=>t.id===e?{...t,carouselImages:s}:t)),console.log(`\ud83d\udd04 Reordered carousel images for row ${e}`)},Z=e=>e.preventDefault(),X=e=>{switch(e){case"published":return"\u2713";case"failed":return"\u2717";case"scheduled":return"\u23f0";case"ready":return"\ud83d\udfe2";default:return"\ud83d\udcdd"}},ee=e=>{switch(e){case"published":return"ig-status-published";case"failed":return"ig-status-failed";case"scheduled":return"ig-status-scheduled";case"ready":return"ig-status-ready";default:return"ig-status-draft"}},se=e=>{const s=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`;return h.filter(e=>e.scheduledDate===s)};return(0,c.jsxs)("div",{className:"ig-bulk-composer",children:[(0,c.jsx)("div",{className:"ig-bulk-composer-header",children:(0,c.jsx)("h2",{children:"Instagram Bulk Composer"})}),(0,c.jsxs)("div",{className:"ig-bulk-composer-content",children:[(0,c.jsxs)("div",{className:"ig-strategy-step",children:[(0,c.jsx)("h3",{children:"Step 1: Strategy & Schedule"}),(0,c.jsxs)("div",{className:"ig-strategy-form",children:[(0,c.jsxs)("div",{className:"ig-form-group",children:[(0,c.jsx)("label",{children:"Post Type"}),(0,c.jsxs)("div",{className:"ig-post-type-toggle",children:[(0,c.jsxs)("button",{className:"photo"===y?"active":"",onClick:()=>V("photo"),children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,c.jsx)("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),(0,c.jsx)("polyline",{points:"21,15 16,10 5,21"})]}),"Photo"]}),(0,c.jsxs)("button",{className:"carousel"===y?"active":"",onClick:()=>V("carousel"),children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),(0,c.jsx)("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),(0,c.jsx)("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),"Carousel"]}),(0,c.jsxs)("button",{className:"reel"===y?"active":"",onClick:()=>V("reel"),children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("polygon",{points:"23 7 16 12 23 17 23 7"}),(0,c.jsx)("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})]}),"Reel"]})]}),"carousel"===y&&(0,c.jsxs)("div",{className:"ig-form-group",children:[(0,c.jsxs)("label",{children:["Number of Images: ",w]}),(0,c.jsx)("input",{type:"range",min:"2",max:"7",value:w,onChange:e=>{return s=parseInt(e.target.value),N(s),void p(e=>e.map(e=>({...e,carouselImageCount:"carousel"===e.postType?s:e.carouselImageCount})));var s},className:"ig-slider"}),(0,c.jsxs)("div",{className:"ig-slider-labels",children:[(0,c.jsx)("span",{children:"2"}),(0,c.jsx)("span",{children:"3"}),(0,c.jsx)("span",{children:"4"}),(0,c.jsx)("span",{children:"5"}),(0,c.jsx)("span",{children:"6"}),(0,c.jsx)("span",{children:"7"})]})]})]}),(0,c.jsxs)("div",{className:"ig-form-group",children:[(0,c.jsx)("label",{children:"Strategy Template"}),(0,c.jsxs)("select",{value:m.promptTemplate,onChange:e=>O("promptTemplate",e.target.value),className:"ig-form-select",children:[(0,c.jsx)("option",{value:"",children:"Select a template..."}),W.map(e=>(0,c.jsx)("option",{value:e.prompt,children:e.name},e.id))]})]}),"custom"===m.promptTemplate&&(0,c.jsxs)("div",{className:"ig-form-group",children:[(0,c.jsx)("label",{children:"Brand Information"}),(0,c.jsxs)("div",{className:"ig-form-row",children:[(0,c.jsx)("div",{className:"ig-form-group",children:(0,c.jsx)("input",{type:"text",value:m.brandName,onChange:e=>O("brandName",e.target.value),placeholder:"Brand Name",className:"ig-form-input"})}),(0,c.jsx)("div",{className:"ig-form-group",children:(0,c.jsx)("input",{type:"text",value:m.hookIdea,onChange:e=>O("hookIdea",e.target.value),placeholder:"Hook Idea (e.g., Tired of the shore?)",className:"ig-form-input"})})]}),(0,c.jsxs)("div",{className:"ig-form-group",children:[(0,c.jsx)("label",{children:"Features (one per line)"}),(0,c.jsx)("textarea",{value:m.features,onChange:e=>O("features",e.target.value),placeholder:"\u2705 Feature 1\\n\u2705 Feature 2\\n\u2705 Feature 3",className:"ig-form-input",rows:"3"})]}),(0,c.jsxs)("div",{className:"ig-form-row",children:[(0,c.jsx)("div",{className:"ig-form-group",children:(0,c.jsx)("input",{type:"text",value:m.location,onChange:e=>O("location",e.target.value),placeholder:"Location",className:"ig-form-input"})}),(0,c.jsx)("div",{className:"ig-form-group",children:(0,c.jsx)("input",{type:"text",value:m.phone,onChange:e=>O("phone",e.target.value),placeholder:"Phone Number",className:"ig-form-input"})})]}),(0,c.jsx)("div",{className:"ig-form-group",children:(0,c.jsx)("input",{type:"text",value:m.website,onChange:e=>O("website",e.target.value),placeholder:"Website URL",className:"ig-form-input"})}),(0,c.jsx)("div",{className:"ig-form-group",children:(0,c.jsx)("textarea",{value:m.callToAction,onChange:e=>O("callToAction",e.target.value),placeholder:"Call to Action (e.g., Book your appointment today!)",className:"ig-form-input",rows:"2"})}),(0,c.jsx)("small",{className:"ig-form-help",children:"This information will be used to generate captions that follow your brand's style and approach."})]}),(0,c.jsxs)("div",{className:"ig-form-row",children:[(0,c.jsxs)("div",{className:"ig-form-group",children:[(0,c.jsx)("label",{children:"Start Date"}),(0,c.jsx)("input",{type:"date",value:m.startDate,onChange:e=>O("startDate",e.target.value),className:"ig-form-input"})]}),(0,c.jsxs)("div",{className:"ig-form-group",children:[(0,c.jsx)("label",{children:"End Date (Optional)"}),(0,c.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,c.jsx)("input",{type:"date",value:m.endDate,onChange:e=>O("endDate",e.target.value),className:"ig-form-input",min:m.startDate,disabled:!m.startDate}),(0,c.jsxs)("button",{type:"button",onClick:()=>O("endDate",""),className:"ig-btn ig-btn-secondary ig-btn-small",disabled:!m.endDate,title:"Clear end date (single day schedule)",children:[(0,c.jsxs)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,c.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),"Clear"]})]}),(0,c.jsx)("small",{className:"ig-form-help",children:"Leave empty for single day schedule"})]}),(0,c.jsxs)("div",{className:"ig-form-group",children:[(0,c.jsx)("label",{children:"Frequency"}),(0,c.jsxs)("select",{value:m.frequency,onChange:e=>O("frequency",e.target.value),className:"ig-form-select",children:[(0,c.jsx)("option",{value:"daily",children:"Daily"}),(0,c.jsx)("option",{value:"weekly",children:"Weekly"}),(0,c.jsx)("option",{value:"monthly",children:"Monthly"}),(0,c.jsx)("option",{value:"custom",children:"Custom Cron"})]})]}),(0,c.jsxs)("div",{className:"ig-form-group",children:[(0,c.jsx)("label",{children:"Time Slot"}),(0,c.jsx)("input",{type:"time",value:m.timeSlot,onChange:e=>O("timeSlot",e.target.value),className:"ig-form-input"})]})]}),"custom"===m.frequency&&(0,c.jsxs)("div",{className:"ig-form-group",children:[(0,c.jsx)("label",{children:"Custom Cron Expression"}),(0,c.jsx)("input",{type:"text",value:m.customCron,onChange:e=>O("customCron",e.target.value),placeholder:"0 9 * * * (daily at 9 AM)",className:"ig-form-input"})]})]})]}),(0,c.jsxs)("div",{className:"ig-calendar-preview-section",children:[(0,c.jsx)("h3",{children:"Calendar Preview"}),(0,c.jsxs)("div",{className:"ig-calendar-container",children:[(0,c.jsxs)("div",{className:"ig-calendar-header",children:[(0,c.jsx)("button",{onClick:()=>C(e=>new Date(e.getFullYear(),e.getMonth()-1)),className:"ig-btn ig-btn-secondary ig-btn-small",children:"\u2190"}),(0,c.jsx)("h4",{children:k.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),(0,c.jsx)("button",{onClick:()=>C(e=>new Date(e.getFullYear(),e.getMonth()+1)),className:"ig-btn ig-btn-secondary ig-btn-small",children:"\u2192"})]}),(0,c.jsxs)("div",{className:"ig-calendar-grid",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,c.jsx)("div",{className:"ig-calendar-day-header",children:e},e)),((e,s)=>{const t=new Date(e,s+1,0).getDate(),a=new Date(e,s,1).getDay(),i=[];for(let l=0;l<a;l++)i.push({day:null,date:null});for(let l=1;l<=t;l++){const t=new Date(e,s,l);i.push({day:l,date:t})}return i})(k.getFullYear(),k.getMonth()).map((e,s)=>(0,c.jsxs)("div",{className:`ig-calendar-day ${e.date?"clickable":""} ${e.date&&se(e.date).length>0?"has-posts":""}`,onClick:()=>{return e.date&&(s=e.date,void g(e=>({...e,startDate:s.toISOString().split("T")[0]})));var s},children:[(0,c.jsx)("span",{className:"ig-day-number",children:e.day}),e.date&&se(e.date).length>0&&(0,c.jsx)("div",{className:"ig-post-indicators",children:se(e.date).map((e,s)=>(0,c.jsx)("div",{className:"ig-post-dot",title:`${e.scheduledTime} - ${(e.caption||"").substring(0,30)}...`},s))})]},s))]})]})]}),(0,c.jsxs)("div",{className:"ig-composer-grid-section",children:[(0,c.jsxs)("div",{className:"ig-composer-header",children:[(0,c.jsx)("h3",{children:"Step 2: Content Grid"}),(0,c.jsxs)("div",{className:"ig-composer-controls",children:[(0,c.jsxs)("button",{onClick:()=>{const e={id:`row-${Date.now()}-${Math.random()}`,caption:"",postType:y.toLowerCase(),mediaFile:null,mediaPreview:null,carouselImages:"carousel"===y?[]:null,carouselImageCount:"carousel"===y?w:null,scheduledDate:(new Date).toISOString().split("T")[0],scheduledTime:m.timeSlot,status:"draft",isSelected:!1};p(s=>[...s,e])},className:"ig-control-btn ig-control-btn-primary",children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,c.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Add Row"]}),(0,c.jsx)("button",{onClick:()=>{x.length===h.length?v([]):v(h.map(e=>e.id))},className:"ig-control-btn ig-control-btn-secondary",children:x.length===h.length?(0,c.jsx)(c.Fragment,{children:"Deselect All"}):(0,c.jsx)(c.Fragment,{children:"Select All"})}),(0,c.jsx)("button",{onClick:()=>{p(e=>e.filter(e=>!x.includes(e.id))),v([])},disabled:0===x.length,className:"ig-control-btn ig-control-btn-danger",children:(0,c.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("polyline",{points:"3,6 5,6 21,6"}),(0,c.jsx)("path",{d:"M19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"})]})}),(0,c.jsxs)("button",{className:"ig-control-btn ig-control-btn-primary ig-control-btn-featured",onClick:async()=>{if(0!==x.length)if(m.promptTemplate){I(!0),P(0);try{const s=h.filter(e=>x.includes(e.id)),t=[];let a="";if("custom"===m.promptTemplate)a=`\n          Brand Name: ${m.brandName||"Not specified"}\n          Hook Idea: ${m.hookIdea||"Not specified"}\n          Key Features: ${m.features||"Not specified"}\n          Location: ${m.location||"Not specified"}\n          Phone: ${m.phone||"Not specified"}\n          Website: ${m.website||"Not specified"}\n          Call to Action: ${m.callToAction||"Not specified"}\n          Image Prompt: ${m.imagePrompt||"Not specified"}\n          \n          Custom Template:\n          ${m.customStrategyTemplate||""}\n        `;else{const e=W.find(e=>e.prompt===m.promptTemplate);if(!e)return alert("Invalid strategy template selected."),void I(!1);a=e.prompt}for(let r=0;r<s.length;r++){try{const e={scheduledDate:s[r].scheduledDate},i=`${a}\n\nContext: ${JSON.stringify(e,null,2)}`,o=await l.A.generateInstagramCaption(i);o.success?t.push({content:o.content||o.generated_text||"No content generated",context:e.scheduledDate,success:!0}):(console.error("Caption generation failed:",o.error),t.push({content:`Failed to generate caption for: ${e.scheduledDate}`,context:e.scheduledDate,success:!1,error:o.error||"Unknown error"}))}catch(e){console.error("Error generating caption:",e),t.push({content:`Error generating caption for: ${s[r].scheduledDate}`,context:s[r].scheduledDate,success:!1,error:e.message})}P(Math.round((r+1)/s.length*100))}p(e=>e.map(e=>{if(!x.includes(e.id))return e;const s=t.find(s=>s.context===e.scheduledDate);return s&&s.success?{...e,caption:s.content,status:"ready"}:e}));const i=t.filter(e=>e.success).length,o=t.length-i;let n="";n=i>0&&0===o?`Successfully generated captions for ${i} ${1===i?"post":"posts"}.`:i>0?`Generated ${i} captions successfully, but failed to generate ${o}.`:"Failed to generate any captions. Please try again.",alert(n)}catch(e){console.error("Unexpected error in handleGenerateAllCaptions:",e),alert("An unexpected error occurred while generating captions. Please try again.")}finally{I(!1),P(0)}}else alert("Please select a strategy template first.");else alert("Please select at least one row to generate captions for.")},disabled:0===h.length||0===x.length,children:[(0,c.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,c.jsx)("polyline",{points:"14,2 14,8 20,8"}),(0,c.jsx)("line",{x1:"14",y1:"13",x2:"8",y2:"13"}),(0,c.jsx)("line",{x1:"14",y1:"17",x2:"8",y2:"17"})]}),"Generate Captions"]}),(0,c.jsxs)("button",{className:"ig-control-btn ig-control-btn-secondary ig-control-btn-featured",onClick:async()=>{if(0!==x.length){I(!0),P(0);try{const s=h.filter(e=>x.includes(e.id));let t=0,a=0;for(let i=0;i<s.length;i++){const o=s[i];if(o.caption&&(o.caption||"").trim())try{console.log(`Generating image for row ${o.id} with caption: ${o.caption.substring(0,50)}...`);const e=o.caption.trim().substring(0,500);console.log(`Using image prompt (truncated): ${e.substring(0,100)}...`);const s=await l.A.generateInstagramImage(e,"feed");s.success&&s.data&&s.data.image_url?(console.log(`Successfully generated image for row ${o.id}:`,s.data.image_url),p(e=>e.map(e=>e.id===o.id?{...e,mediaFile:null,mediaPreview:s.data.image_url,status:(e.caption||"").trim()?"ready":"draft"}:e)),t++):(console.log(`Failed to generate image for row ${o.id}:`,s),a++)}catch(e){console.error(`Error generating image for row ${o.id}:`,e),a++}else console.log(`Skipping image generation for row ${o.id} - no caption available`)}t>0?alert(`Image generation completed! Successfully generated ${t} images${a>0?`, ${a} failed`:""}`):alert("Failed to generate any images. Please try again.")}catch(e){console.error("Error in bulk image generation:",e),alert("Failed to generate images. Please try again.")}finally{I(!1),P(0)}}else alert("Please select at least one row to generate images.")},disabled:0===h.length||0===x.length,children:[(0,c.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,c.jsx)("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),"Generate Images"]})]})]}),(0,c.jsx)("div",{className:"ig-composer-grid-container",children:(0,c.jsxs)("div",{className:"ig-composer-grid",ref:M,children:[(0,c.jsxs)("div",{className:"ig-grid-header ig-grid-row",children:[(0,c.jsx)("div",{className:"ig-grid-cell ig-header-cell"}),(0,c.jsx)("div",{className:"ig-grid-cell ig-header-cell",children:"Caption"}),(0,c.jsx)("div",{className:"ig-grid-cell ig-header-cell",children:"Media"}),(0,c.jsx)("div",{className:"ig-grid-cell ig-header-cell",children:"Date"}),(0,c.jsx)("div",{className:"ig-grid-cell ig-header-cell",children:"Time"}),(0,c.jsx)("div",{className:"ig-grid-cell ig-header-cell",children:"Status"})]}),(0,c.jsx)("div",{className:"ig-grid-body",children:h.map((e,s)=>{var t,a;return(0,c.jsxs)("div",{className:"ig-grid-row "+(e.isSelected?"selected":""),draggable:!0,onDragStart:()=>{return s=e.id,j(s);var s},onDragOver:Z,onDrop:()=>(e=>{if(f&&f!==e){const s=[...h],t=s.findIndex(e=>e.id===f),a=s.findIndex(s=>s.id===e),[i]=s.splice(t,1);s.splice(a,0,i),p(s)}j(null)})(e.id),children:[(0,c.jsx)("div",{className:"ig-grid-cell",children:(0,c.jsx)("input",{type:"checkbox",checked:x.includes(e.id),onChange:()=>{return s=e.id,void v(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s]);var s}})}),(0,c.jsx)("div",{className:"ig-grid-cell ig-caption-cell",children:(0,c.jsxs)("div",{className:"caption-container",children:[(0,c.jsx)("textarea",{value:e.caption,onChange:s=>q(e.id,"caption",s.target.value),placeholder:"Enter your Instagram post caption...",className:"ig-caption-input",rows:"3"}),(0,c.jsx)("button",{onClick:()=>(e=>{const s=h.find(s=>s.id===e);s&&A(s)})(e.id),className:"expand-btn",title:"Expand caption",children:(0,c.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M15 3h6v6"}),(0,c.jsx)("path",{d:"M9 21H3v-6"}),(0,c.jsx)("path",{d:"M21 3l-7 7"}),(0,c.jsx)("path",{d:"M3 21l7-7"})]})})]})}),(0,c.jsx)("div",{className:"ig-grid-cell ig-media-cell",children:(0,c.jsx)("div",{className:"ig-media-options",children:e.mediaPreview||e.mediaFile||e.carouselImages&&0!==e.carouselImages.length?(0,c.jsx)("div",{className:"ig-media-preview-container",children:(0,c.jsx)("div",{className:"ig-media-preview",children:"carousel"===e.postType&&e.carouselImages&&e.carouselImages.length>0?(0,c.jsxs)("div",{className:"ig-carousel-preview",style:{position:"relative"},children:[e.carouselUploading&&(0,c.jsx)("div",{className:"ig-carousel-loading-overlay",children:(0,c.jsxs)("div",{className:"ig-spinner",children:[(0,c.jsx)("svg",{width:"40",height:"40",viewBox:"0 0 50 50",children:(0,c.jsx)("circle",{cx:"25",cy:"25",r:"20",fill:"none",stroke:"#888",strokeWidth:"5",strokeDasharray:"31.4 31.4",strokeLinecap:"round",children:(0,c.jsx)("animateTransform",{attributeName:"transform",type:"rotate",from:"0 25 25",to:"360 25 25",dur:"1s",repeatCount:"indefinite"})})}),(0,c.jsx)("span",{children:"Loading images..."})]})}),(0,c.jsx)("div",{className:"ig-carousel-grid",style:e.carouselUploading?{opacity:.5,pointerEvents:"none"}:{},children:e.carouselImages.slice(0,e.carouselImageCount||3).map((s,t)=>(0,c.jsxs)("div",{className:"ig-carousel-item",children:[(0,c.jsx)("img",{src:s,alt:`Carousel ${t+1}`}),(0,c.jsxs)("div",{className:"ig-carousel-item-actions",children:[(0,c.jsx)("button",{onClick:()=>J(e.id,t),className:"ig-carousel-action-btn view-btn",title:"View image",children:(0,c.jsxs)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),(0,c.jsx)("circle",{cx:"12",cy:"12",r:"3"})]})}),(0,c.jsx)("button",{onClick:()=>{return s=e.id,a=t,p(e=>e.map(e=>e.id===s?{...e,carouselImages:e.carouselImages.filter((e,s)=>s!==a),status:(()=>{const s=e.carouselImages.filter((e,s)=>s!==a),t=(e.caption||"").trim(),i=s.length>=2;return t&&i?"ready":"draft"})()}:e)),void console.log(`\ud83d\uddd1\ufe0f Removed carousel image ${a} from row ${s}`);var s,a},className:"ig-carousel-action-btn remove-btn",title:"Remove image",children:(0,c.jsxs)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,c.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,c.jsx)("span",{className:"ig-carousel-number",children:t+1})]},t))}),(0,c.jsxs)("div",{className:"ig-carousel-info",children:[(0,c.jsxs)("div",{className:"ig-carousel-status",children:[e.carouselImages.length," / ",e.carouselImageCount||2," images",e.carouselImages.length<2&&(0,c.jsx)("span",{className:"ig-carousel-warning",children:"\u26a0\ufe0f Need at least 2 images"}),e.carouselImages.length>=2&&(0,c.jsx)("span",{className:"ig-carousel-success",children:"\u2705 Ready"})]}),(0,c.jsxs)("div",{className:"ig-carousel-actions",children:[(0,c.jsxs)("button",{onClick:()=>(e=>{const s=h.find(s=>s.id===e);s&&s.carouselImages&&s.carouselImages.length>0&&B(s)})(e.id),className:"ig-btn ig-btn-secondary ig-btn-small",title:"View & reorder carousel",children:[(0,c.jsxs)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),(0,c.jsx)("circle",{cx:"12",cy:"12",r:"3"})]}),"View & Reorder"]}),(0,c.jsxs)("button",{onClick:()=>{return s=e.id,p(e=>e.map(e=>e.id===s?{...e,carouselImages:[],status:"draft"}:e)),void console.log(`\ud83d\uddd1\ufe0f Removed carousel images for row ${s}`);var s},className:"ig-btn ig-btn-danger ig-btn-small",disabled:0===e.carouselImages.length,title:"Remove all carousel images",children:[(0,c.jsxs)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,c.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),"Remove All"]})]})]})]}):(0,c.jsx)(c.Fragment,{children:"reel"===e.postType?(0,c.jsxs)("div",{className:"ig-reel-container",children:[(0,c.jsxs)("div",{className:"ig-reel-video-card",children:[(0,c.jsx)("video",{src:e.mediaPreview,controls:!0}),(0,c.jsxs)("div",{className:"ig-media-actions",children:[(0,c.jsx)("button",{onClick:()=>H(e.id),className:"ig-media-action-btn view-btn",title:"View video",children:(0,c.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),(0,c.jsx)("circle",{cx:"12",cy:"12",r:"3"})]})}),(0,c.jsx)("button",{onClick:()=>Y(e.id),className:"ig-media-action-btn remove-btn",title:"Remove video",children:(0,c.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,c.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]}),(0,c.jsx)("div",{className:"ig-reel-thumbnail-card",children:e.thumbnailPreview?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("img",{src:e.thumbnailPreview,alt:"Thumbnail"}),(0,c.jsxs)("div",{className:"ig-media-actions",children:[(0,c.jsx)("button",{onClick:()=>(e=>{const s=h.find(s=>s.id===e);s&&s.thumbnailPreview&&G({...s,mediaPreview:s.thumbnailPreview,mediaType:"thumbnail"})})(e.id),className:"ig-media-action-btn view-btn",title:"View thumbnail",children:(0,c.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),(0,c.jsx)("circle",{cx:"12",cy:"12",r:"3"})]})}),(0,c.jsx)("button",{onClick:()=>{return s=e.id,void p(e=>e.map(e=>e.id===s?{...e,thumbnailFile:null,thumbnailPreview:null,thumbnailUrl:null}:e));var s},className:"ig-media-action-btn remove-btn",title:"Remove thumbnail",children:(0,c.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,c.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,c.jsx)("input",{type:"file",accept:"image/*",onChange:s=>K(e.id,s),className:"ig-media-input",id:`ig-thumbnail-upload-${e.id}`,disabled:e.thumbnailUploading,style:{display:"none"}}),(0,c.jsx)("label",{htmlFor:`ig-thumbnail-upload-${e.id}`,className:"ig-thumbnail-change-btn",title:"Change thumbnail",children:(0,c.jsxs)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M12 20h9"}),(0,c.jsx)("path",{d:"M16.5 3.5a2.121 2.121 0 1 1 3 3L7 19l-4 1 1-4 12.5-12.5z"})]})})]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"ig-thumbnail-placeholder",children:(0,c.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,c.jsx)("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),(0,c.jsx)("polyline",{points:"21,15 16,10 5,21"})]})}),(0,c.jsx)("input",{type:"file",accept:"image/*",onChange:s=>K(e.id,s),className:"ig-media-input",id:`ig-thumbnail-upload-${e.id}`,disabled:e.thumbnailUploading,style:{display:"none"}}),(0,c.jsxs)("label",{htmlFor:`ig-thumbnail-upload-${e.id}`,className:"ig-thumbnail-upload-btn",title:"Upload thumbnail",children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,c.jsx)("polyline",{points:"7,10 12,15 17,10"}),(0,c.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Upload"]})]})})]}):null!==(t=e.mediaFile)&&void 0!==t&&null!==(a=t.type)&&void 0!==a&&a.startsWith("image/")||!e.mediaFile&&e.mediaPreview?(0,c.jsxs)("div",{className:"ig-single-media-preview",children:[(0,c.jsx)("img",{src:e.mediaPreview,alt:"Preview"}),(0,c.jsxs)("div",{className:"ig-media-actions",children:[(0,c.jsx)("button",{onClick:()=>H(e.id),className:"ig-media-action-btn view-btn",title:"View image",children:(0,c.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),(0,c.jsx)("circle",{cx:"12",cy:"12",r:"3"})]})}),(0,c.jsx)("button",{onClick:()=>Y(e.id),className:"ig-media-action-btn remove-btn",title:"Remove image",children:(0,c.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,c.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]}):(0,c.jsxs)("div",{className:"ig-single-media-preview",children:[(0,c.jsx)("video",{src:e.mediaPreview,controls:!0}),(0,c.jsxs)("div",{className:"ig-media-actions",children:[(0,c.jsx)("button",{onClick:()=>H(e.id),className:"ig-media-action-btn view-btn",title:"View video",children:(0,c.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),(0,c.jsx)("circle",{cx:"12",cy:"12",r:"3"})]})}),(0,c.jsx)("button",{onClick:()=>Y(e.id),className:"ig-media-action-btn remove-btn",title:"Remove video",children:(0,c.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,c.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]})})})}):(0,c.jsxs)("div",{className:"ig-media-option-group",children:[("photo"===e.postType||"reel"===e.postType)&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("input",{type:"file",accept:"photo"===e.postType?"image/*":"video/*",onChange:s=>(async(e,s)=>{const t=s.target.files[0];if(!t)return;const a=h.find(s=>s.id===e);if(!a)return;"reel"===a.postType&&alert("Your video is converted to: 1080x1920 as instagram policy.");const i=new FileReader;i.onload=s=>{p(a=>a.map(a=>a.id===e?{...a,mediaFile:t,mediaPreview:s.target.result,status:(a.caption||"").trim()?"ready":"draft"}:a))},i.readAsDataURL(t)})(e.id,s),className:"ig-media-input",id:`ig-media-upload-${e.id}`}),(0,c.jsxs)("label",{htmlFor:`ig-media-upload-${e.id}`,className:"ig-media-option-btn upload-btn",children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,c.jsx)("polyline",{points:"7,10 12,15 17,10"}),(0,c.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Upload ","photo"===e.postType?"Image":"Video"]})]}),"reel"===e.postType&&(0,c.jsxs)("div",{className:"ig-media-option-btn upload-btn thumbnail-btn disabled",title:"Please upload a video first",children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,c.jsx)("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),(0,c.jsx)("polyline",{points:"21,15 16,10 5,21"})]}),"Upload Thumbnail (Video Required First)"]}),"photo"===e.postType&&(0,c.jsxs)("button",{onClick:()=>(async e=>{try{const s=h.find(s=>s.id===e);if(!s||!(s.caption||"").trim())return void alert("Please add a caption first to generate an image.");console.log(`Generating image for row ${e} with caption: ${s.caption.substring(0,50)}...`);const t=s.caption.trim().substring(0,500);console.log(`Using image prompt (truncated): ${t.substring(0,100)}...`);const a=await l.A.generateInstagramImage(t,"feed");a.success&&a.data&&a.data.image_url?(console.log(`Successfully generated image for row ${e}:`,a.data.image_url),p(s=>s.map(s=>s.id===e?{...s,mediaFile:null,mediaPreview:a.data.image_url,status:(s.caption||"").trim()?"ready":"draft"}:s))):(console.log(`Failed to generate image for row ${e}:`,a),alert("Failed to generate image. Please try again."))}catch(s){console.error(`Error generating image for row ${e}:`,s),alert("Failed to generate image. Please try again.")}})(e.id),className:"ig-media-option-btn generate-btn",children:[(0,c.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,c.jsx)("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),"Generate"]}),"carousel"===e.postType&&(0,c.jsxs)("div",{style:{position:"relative",display:"flex",flexDirection:"column",alignItems:"stretch"},children:[(0,c.jsxs)("button",{onClick:()=>(async e=>{try{const s=h.find(s=>s.id===e);if(!s||!(s.caption||"").trim())return void alert("Please add a caption first to generate carousel images.");console.log(`Generating carousel for row ${e} with caption: ${s.caption.substring(0,50)}...`);const t=s.caption.trim().substring(0,500),a=s.carouselImageCount||3;if(a<2||a>7)return void alert("Carousel must have between 2 and 7 images.");console.log(`\ud83c\udfa8 Generating ${a} carousel images with prompt: ${t}`);const i=await l.A.generateInstagramCarousel(t,a);if(i.success&&i.image_urls&&i.image_urls.length>=2)console.log(`Successfully generated carousel for row ${e}:`,i.image_urls),p(s=>s.map(s=>s.id===e?{...s,carouselImages:i.image_urls,status:(()=>{const e=(s.caption||"").trim(),t=i.image_urls.length>=2;return e&&t?"ready":"draft"})()}:s));else{console.log(`Failed to generate carousel for row ${e}:`,i);const s=i.error||"Failed to generate enough carousel images. Please try again.";alert(`Failed to generate carousel: ${s}`)}}catch(s){console.error(`Error generating carousel for row ${e}:`,s),alert("Error generating carousel images. Please try again.")}})(e.id),className:"ig-media-option-btn generate-btn",children:[(0,c.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,c.jsx)("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),"Generate ",e.carouselImageCount||2," Images"]}),(0,c.jsx)("input",{type:"file",accept:"image/*",multiple:!0,ref:s=>L.current[e.id]=s,onChange:s=>(async(e,s)=>{const t=Array.from(s.target.files);if(0===t.length)return;const a=h.find(s=>s.id===e).carouselImageCount||2;if(t.length<2)alert("Please select at least 2 images for a carousel post.");else if(t.length>a)alert(`Please select only ${a} images for this carousel.`);else{p(s=>s.map(s=>s.id===e?{...s,carouselUploading:!0}:s));try{const s=[];for(let a=0;a<t.length;a++){const i=t[a];if(!i.type.startsWith("image/")){alert(`File ${i.name} is not an image. Please select only image files.`);continue}const o=await l.A.uploadImageToCloudinary(i);if(!(o&&o.success&&o.data&&o.data.url))return alert(`Failed to upload image ${i.name}. Please try again.`),void p(s=>s.map(s=>s.id===e?{...s,carouselUploading:!1}:s));s.push(o.data.url)}s.length>=2?p(t=>t.map(t=>t.id===e?{...t,carouselImages:s,status:(()=>{const e=(t.caption||"").trim(),a=s.length>=2;return e&&a?"ready":"draft"})(),carouselUploading:!1}:t)):(alert("Please upload at least 2 images for a carousel post."),p(s=>s.map(s=>s.id===e?{...s,carouselUploading:!1}:s))),L.current[e]&&(L.current[e].value="")}catch(i){p(s=>s.map(s=>s.id===e?{...s,carouselUploading:!1}:s)),alert("Error uploading carousel images. Please try again.")}}})(e.id,s),className:"ig-media-input",id:`ig-carousel-upload-${e.id}`,disabled:e.carouselUploading},`ig-carousel-upload-${e.id}`),(0,c.jsxs)("label",{htmlFor:`ig-carousel-upload-${e.id}`,className:"ig-media-option-btn upload-btn",style:{opacity:e.carouselUploading?.6:1,pointerEvents:e.carouselUploading?"none":"auto",position:"relative"},children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,c.jsx)("polyline",{points:"7,10 12,15 17,10"}),(0,c.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Upload ",e.carouselImageCount||2," Images",e.carouselUploading&&(0,c.jsx)("span",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.7)",zIndex:2},children:(0,c.jsx)("span",{className:"ig-spinner",style:{margin:0},children:(0,c.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 50 50",children:(0,c.jsx)("circle",{cx:"25",cy:"25",r:"20",fill:"none",stroke:"#888",strokeWidth:"5",strokeDasharray:"31.4 31.4",strokeLinecap:"round",children:(0,c.jsx)("animateTransform",{attributeName:"transform",type:"rotate",from:"0 25 25",to:"360 25 25",dur:"1s",repeatCount:"indefinite"})})})})})]})]})]})})}),(0,c.jsx)("div",{className:"ig-grid-cell ig-date-cell",children:(0,c.jsx)("input",{type:"date",value:e.scheduledDate,onChange:s=>q(e.id,"scheduledDate",s.target.value),className:"ig-date-input"})}),(0,c.jsx)("div",{className:"ig-grid-cell ig-time-cell",children:(0,c.jsx)("input",{type:"time",value:e.scheduledTime,onChange:s=>q(e.id,"scheduledTime",s.target.value),className:"ig-time-input"})}),(0,c.jsx)("div",{className:"ig-grid-cell ig-status-cell",children:(0,c.jsxs)("span",{className:`ig-status-badge ${ee(e.status)}`,children:[X(e.status)," ",e.status]})})]},e.id)})})]})})]}),(0,c.jsxs)("div",{className:"ig-queue-confirmation",children:[(0,c.jsx)("h3",{children:"Step 3: Schedule & Publish"}),(0,c.jsxs)("div",{className:"ig-confirmation-stats",children:[(0,c.jsxs)("div",{className:"ig-stat-item",children:[(0,c.jsx)("span",{className:"ig-stat-label",children:"Total Posts:"}),(0,c.jsx)("span",{className:"ig-stat-value",children:h.length})]}),(0,c.jsxs)("div",{className:"ig-stat-item",children:[(0,c.jsx)("span",{className:"ig-stat-label",children:"With Captions:"}),(0,c.jsx)("span",{className:"ig-stat-value",children:h.filter(e=>(e.caption||"").trim()).length})]}),(0,c.jsxs)("div",{className:"ig-stat-item",children:[(0,c.jsx)("span",{className:"ig-stat-label",children:"Ready to Schedule:"}),(0,c.jsx)("span",{className:"ig-stat-value",children:h.filter(e=>"ready"===e.status).length})]}),(0,c.jsxs)("div",{className:"ig-stat-item",children:[(0,c.jsx)("span",{className:"ig-stat-label",children:"With Media:"}),(0,c.jsx)("span",{className:"ig-stat-value",children:h.filter(e=>e.mediaFile||e.mediaPreview).length})]})]}),S&&(0,c.jsxs)("div",{className:"ig-schedule-progress",children:[(0,c.jsx)("div",{className:"ig-progress-bar",children:(0,c.jsx)("div",{className:"ig-progress-fill",style:{width:`${_}%`}})}),(0,c.jsxs)("span",{className:"ig-progress-text",children:["Scheduling Instagram posts... ",Math.round(_),"%"]})]}),(0,c.jsx)("div",{className:"ig-confirmation-actions",children:(0,c.jsx)("button",{onClick:async()=>{if(o&&0!==h.length){I(!0),P(0);try{const a=h.filter(e=>"ready"===e.status);console.log(`\ud83d\udd04 Starting bulk scheduling for ${a.length} posts...`);let i=0;const n=a.length,c=(await Promise.all(a.map(async(e,s)=>{const t={caption:e.caption,scheduled_datetime:`${e.scheduledDate}T${e.scheduledTime}:00+05:30`,scheduled_date:e.scheduledDate,scheduled_time:e.scheduledTime,post_type:(e.postType||"photo").toLowerCase()};if("photo"===e.postType){if(e.mediaFile){const s={...t,media_file:await(0,r.bB)(e.mediaFile),media_filename:e.mediaFile.name};return i++,P(i/n*30),s}if(e.mediaPreview&&e.mediaPreview.startsWith("data:")){const s={...t,media_file:e.mediaPreview,media_filename:"generated_image.jpg"};return i++,P(i/n*30),s}if(e.mediaPreview&&e.mediaPreview.startsWith("http")){const s={...t,image_prompt:e.caption.substring(0,200)};return i++,P(i/n*30),s}{const s={...t,image_prompt:m.imagePrompt||e.caption.substring(0,200)};return i++,P(i/n*30),s}}if("carousel"===e.postType){if(e.carouselImages&&e.carouselImages.length>0){const s=e.carouselImages,a={...t,carousel_images:s,carousel_filenames:s.map((e,s)=>`carousel_image_${s+1}.jpg`)};return i++,P(i/n*30),a}{const s={...t,carousel_image_count:e.carouselImageCount||2,image_prompt:m.imagePrompt||e.caption.substring(0,200)};return i++,P(i/n*30),s}}if("reel"===e.postType){if(e.mediaFile){const s={...t,media_file:await(0,r.bB)(e.mediaFile),media_filename:e.mediaFile.name};return e.thumbnailUrl&&e.thumbnailUrl.startsWith("http")?s.thumbnail_url=e.thumbnailUrl:e.thumbnailPreview&&e.thumbnailPreview.startsWith("http")?s.thumbnail_url=e.thumbnailPreview:e.thumbnailFile&&(s.thumbnail_file=await(0,r.bB)(e.thumbnailFile),s.thumbnail_filename=e.thumbnailFile.name),i++,P(i/n*30),s}if(e.mediaPreview&&e.mediaPreview.startsWith("data:")){const s={...t,media_file:e.mediaPreview,media_filename:"generated_video.mp4"};return e.thumbnailUrl&&e.thumbnailUrl.startsWith("http")?s.thumbnail_url=e.thumbnailUrl:e.thumbnailPreview&&e.thumbnailPreview.startsWith("http")?s.thumbnail_url=e.thumbnailPreview:e.thumbnailFile&&(s.thumbnail_file=await(0,r.bB)(e.thumbnailFile),s.thumbnail_filename=e.thumbnailFile.name),i++,P(i/n*30),s}{const s={...t,image_prompt:m.imagePrompt||e.caption.substring(0,200)};return i++,P(i/n*30),s}}return i++,P(i/n*30),t}))).map(e=>({...e,post_type:(e.post_type||"photo").toLowerCase()})),d={social_account_id:o.id,posts:c};console.log(`\ud83d\ude80 Sending ${c.length} posts to backend for scheduling...`),console.log("\ud83d\udccb Bulk data being sent:",JSON.stringify(d,null,2)),P(40);const g=await l.A.bulkScheduleInstagramPosts(d);if(P(90),console.log("Bulk schedule response:",g),g&&g.success){var e,s,t;console.log(`\u2705 Successfully scheduled ${(null===(e=g.scheduled_posts)||void 0===e?void 0:e.length)||0} posts`),console.log("\ud83d\udccb Response:",g),p(e=>e.map(e=>a.some(s=>s.id===e.id)?{...e,status:"scheduled"}:e)),P(100),$(g.scheduled_posts||[]);const i=g.message||`Successfully scheduled ${(null===(s=g.scheduled_posts)||void 0===s?void 0:s.length)||0} Instagram posts!`;alert(i),u({type:"success",platform:"instagram",strategyName:"custom"===m.promptTemplate?"Custom Strategy":(null===(t=W.find(e=>e.prompt===m.promptTemplate))||void 0===t?void 0:t.name)||"Bulk Schedule",message:i+" You'll receive alerts 10 minutes before each post goes live."}),R("/instagram",{state:{scheduledGridRows:g.scheduled_posts||[]}})}else if(g&&Array.isArray(g.results)){const e=g.results.filter(e=>e.success).length,s=g.results.filter(e=>!e.success).length;let t=`Scheduled ${e} posts successfully.`;if(s>0&&(t+=`\n${s} posts failed. Check console for details.`,g.results.forEach((e,s)=>{e.success||(t+=`\nPost #${s+1}: ${e.error||e.message||"Unknown error"}`)})),alert(t),e>0){const s=W.find(e=>e.prompt===m.promptTemplate),t=s?s.name:"Bulk Schedule";u({type:"success",platform:"instagram",strategyName:t,message:`Successfully scheduled ${e} Instagram posts! You'll receive alerts 10 minutes before each post goes live.`})}p(e=>e.map(e=>{const s=g.results.find(s=>s.caption===e.caption&&s.scheduled_date===e.scheduledDate);return s?{...e,status:s.success?"scheduled":"failed",error:s.success?null:s.error||"Unknown error"}:e})),P(100),$(g.results.filter(e=>e.success)),R("/instagram",{state:{scheduledGridRows:g.results.filter(e=>e.success)}})}else{let e="Error scheduling Instagram posts.";console.error("\u274c Bulk scheduling error response:",g),g&&g.failed_posts&&g.failed_posts.length>0?(e+=`\n${g.failed_posts.length} posts failed:`,g.failed_posts.forEach(s=>{e+=`\nPost #${s.index+1}: ${s.error}`}),g.scheduled_posts&&g.scheduled_posts.length>0&&(e=`Partial success: ${g.scheduled_posts.length} posts scheduled, ${g.failed_posts.length} failed.\n\nFailed posts:`,g.failed_posts.forEach(s=>{e+=`\nPost #${s.index+1}: ${s.error}`}),p(e=>e.map(e=>g.scheduled_posts.find(s=>s.caption===e.caption)?{...e,status:"scheduled"}:e)))):g&&g.message?e+=`\n${g.message}`:g&&g.errorData&&(e+=`\nAPI Error: ${JSON.stringify(g.errorData)}`),alert(e),console.error("Bulk scheduling error:",g)}}catch(a){let e="Error scheduling Instagram posts. Please try again.";const s=h.filter(e=>x.includes(e.id)).some(e=>"reel"===(e.postType||"").toLowerCase());a&&"timeout"===a.error?e=s?"Your reel is being processed and will be scheduled soon. Please check back in a few minutes.":"Request timed out. Video processing may take longer. Please try again or check your video file size.":a&&a.errorData?e+=`\nAPI Error: ${JSON.stringify(a.errorData)}`:a&&a.message&&(e+=`\n${a.message}`),alert(e),console.error("Bulk scheduling exception:",a)}finally{I(!1),P(0)}}},disabled:S||0===h.filter(e=>"ready"===e.status).length,className:"ig-btn ig-btn-primary ig-btn-large",children:S?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,c.jsx)("path",{d:"M21 12a9 9 0 11-6.219-8.56"})}),"Scheduling..."]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,c.jsx)("polyline",{points:"12,6 12,12 16,14"})]}),"Schedule Ready Posts (",h.filter(e=>"ready"===e.status).length,")"]})})})]})]}),D&&(0,c.jsx)("div",{className:"modal-overlay",children:(0,c.jsxs)("div",{className:"modal-content",children:[(0,c.jsxs)("div",{className:"modal-header",children:[(0,c.jsx)("h3",{children:"Edit Caption"}),(0,c.jsx)("button",{onClick:()=>A(null),className:"modal-close",children:"\xd7"})]}),(0,c.jsxs)("div",{className:"modal-body",children:[(0,c.jsx)("div",{className:"caption-info",children:(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Scheduled:"})," ",D.scheduledDate," at ",D.scheduledTime]})}),(0,c.jsx)("textarea",{value:D.caption,onChange:e=>A(s=>({...s,caption:e.target.value})),className:"expanded-caption-textarea",rows:"10",placeholder:"Enter your caption..."})]}),(0,c.jsxs)("div",{className:"modal-footer",children:[(0,c.jsx)("button",{onClick:()=>A(null),className:"ig-btn ig-btn-secondary",children:"Cancel"}),(0,c.jsx)("button",{onClick:()=>{return e=D.id,s=D.caption,p(t=>t.map(t=>t.id===e?{...t,caption:s,status:(s||"").trim()&&(t.mediaFile||t.mediaPreview)?"ready":"draft"}:t)),void A(null);var e,s},className:"ig-btn ig-btn-primary",children:"Save Changes"})]})]})}),F&&(0,c.jsx)("div",{className:"modal-overlay "+(F.isNested?"modal-overlay-nested":""),children:(0,c.jsxs)("div",{className:"modal-content media-preview-modal",children:[(0,c.jsxs)("div",{className:"modal-header",children:[(0,c.jsx)("h3",{children:"carousel-image"===F.mediaType?`Carousel Image ${F.imageIndex+1}`:"thumbnail"===F.mediaType?"Thumbnail Preview":"Media Preview"}),(0,c.jsx)("button",{onClick:()=>E(null),className:"modal-close",children:"\xd7"})]}),(0,c.jsxs)("div",{className:"modal-body",children:[null!==(s=F.mediaFile)&&void 0!==s&&null!==(t=s.type)&&void 0!==t&&t.startsWith("image/")||!F.mediaFile&&F.mediaPreview?(0,c.jsx)("img",{src:F.mediaPreview,alt:"Media preview",className:"modal-media"}):(0,c.jsx)("video",{src:F.mediaPreview,controls:!0,className:"modal-media"}),F.caption&&(0,c.jsxs)("div",{className:"modal-caption",children:[(0,c.jsx)("h4",{children:"Caption:"}),(0,c.jsx)("p",{children:F.caption})]})]}),(0,c.jsx)("div",{className:"modal-footer",children:(0,c.jsx)("button",{onClick:()=>E(null),className:"ig-btn ig-btn-primary",children:"Close"})})]})}),T&&(0,c.jsx)("div",{className:"modal-overlay",children:(0,c.jsxs)("div",{className:"modal-content carousel-reorder-modal",children:[(0,c.jsxs)("div",{className:"modal-header",children:[(0,c.jsx)("h3",{children:"Reorder Carousel Images"}),(0,c.jsx)("button",{onClick:()=>B(null),className:"modal-close",children:"\xd7"})]}),(0,c.jsxs)("div",{className:"modal-body",children:[(0,c.jsx)("p",{className:"reorder-instructions",children:"Drag and drop to reorder images. The first image will be the cover image."}),(0,c.jsx)("div",{className:"carousel-reorder-grid",children:T.carouselImages.map((e,s)=>(0,c.jsxs)("div",{className:"carousel-reorder-item",draggable:!0,onDragStart:e=>e.dataTransfer.setData("text/plain",s),onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault();const t=parseInt(e.dataTransfer.getData("text/plain")),a=s;if(t!==a){const e=[...T.carouselImages],s=e[t];e.splice(t,1),e.splice(a,0,s),B(s=>({...s,carouselImages:e}))}},children:[(0,c.jsx)("img",{src:e,alt:`Carousel ${s+1}`}),(0,c.jsxs)("div",{className:"carousel-reorder-overlay",children:[(0,c.jsx)("span",{className:"carousel-reorder-number",children:s+1}),(0,c.jsx)("button",{onClick:()=>J(T.id,s),className:"carousel-reorder-view",title:"View full size",children:(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),(0,c.jsx)("circle",{cx:"12",cy:"12",r:"3"})]})}),(0,c.jsx)("button",{onClick:()=>{const e=T.carouselImages.filter((e,t)=>t!==s);B(s=>({...s,carouselImages:e}))},className:"carousel-reorder-remove",title:"Remove image",children:(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,c.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),0===s&&(0,c.jsx)("div",{className:"carousel-cover-badge",children:"Cover"})]},s))})]}),(0,c.jsxs)("div",{className:"modal-footer",children:[(0,c.jsx)("button",{onClick:()=>B(null),className:"ig-btn ig-btn-secondary",children:"Cancel"}),(0,c.jsx)("button",{onClick:()=>{Q(T.id,T.carouselImages),B(null)},className:"ig-btn ig-btn-primary",children:"Save Order"})]})]})}),U&&(0,c.jsx)("div",{className:"modal-overlay",children:(0,c.jsxs)("div",{className:"modal-content media-preview-modal",children:[(0,c.jsxs)("div",{className:"modal-header",children:[(0,c.jsx)("h3",{children:"Thumbnail Preview"}),(0,c.jsx)("button",{onClick:()=>G(null),className:"modal-close",children:"\xd7"})]}),(0,c.jsxs)("div",{className:"modal-body",children:[(0,c.jsx)("img",{src:U.mediaPreview,alt:"Thumbnail preview",className:"modal-media"}),(0,c.jsxs)("div",{className:"modal-caption",children:[(0,c.jsx)("h4",{children:"Reel Thumbnail"}),(0,c.jsx)("p",{children:"This image will be used as the cover for your reel video."})]})]}),(0,c.jsx)("div",{className:"modal-footer",children:(0,c.jsx)("button",{onClick:()=>G(null),className:"ig-btn ig-btn-primary",children:"Close"})})]})}),T&&(0,c.jsx)("div",{className:"modal-overlay",children:(0,c.jsxs)("div",{className:"modal-content carousel-reorder-modal",children:[(0,c.jsxs)("div",{className:"modal-header",children:[(0,c.jsx)("h3",{children:"Reorder Carousel Images"}),(0,c.jsx)("button",{onClick:()=>B(null),className:"modal-close",children:"\xd7"})]}),(0,c.jsxs)("div",{className:"modal-body",children:[(0,c.jsx)("p",{className:"reorder-instructions",children:"Drag and drop to reorder images. The first image will be the cover image."}),(0,c.jsx)("div",{className:"carousel-reorder-grid",children:T.carouselImages.map((e,s)=>(0,c.jsxs)("div",{className:"carousel-reorder-item",draggable:!0,onDragStart:e=>e.dataTransfer.setData("text/plain",s),onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault();const t=parseInt(e.dataTransfer.getData("text/plain")),a=s;if(t!==a){const e=[...T.carouselImages],s=e[t];e.splice(t,1),e.splice(a,0,s),B(s=>({...s,carouselImages:e}))}},children:[(0,c.jsx)("img",{src:e,alt:`Carousel ${s+1}`}),(0,c.jsxs)("div",{className:"carousel-reorder-overlay",children:[(0,c.jsx)("span",{className:"carousel-reorder-number",children:s+1}),(0,c.jsx)("button",{onClick:()=>J(T.id,s),className:"carousel-reorder-view",title:"View full size",children:(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),(0,c.jsx)("circle",{cx:"12",cy:"12",r:"3"})]})}),(0,c.jsx)("button",{onClick:()=>{const e=T.carouselImages.filter((e,t)=>t!==s);B(s=>({...s,carouselImages:e}))},className:"carousel-reorder-remove",title:"Remove image",children:(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,c.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),0===s&&(0,c.jsx)("div",{className:"carousel-cover-badge",children:"Cover"})]},s))})]}),(0,c.jsxs)("div",{className:"modal-footer",children:[(0,c.jsx)("button",{onClick:()=>B(null),className:"ig-btn ig-btn-secondary",children:"Cancel"}),(0,c.jsx)("button",{onClick:()=>{Q(T.id,T.carouselImages),B(null)},className:"ig-btn ig-btn-primary",children:"Save Order"})]})]})}),U&&(0,c.jsx)("div",{className:"modal-overlay",children:(0,c.jsxs)("div",{className:"modal-content media-preview-modal",children:[(0,c.jsxs)("div",{className:"modal-header",children:[(0,c.jsx)("h3",{children:"Thumbnail Preview"}),(0,c.jsx)("button",{onClick:()=>G(null),className:"modal-close",children:"\xd7"})]}),(0,c.jsxs)("div",{className:"modal-body",children:[(0,c.jsx)("img",{src:U.mediaPreview,alt:"Thumbnail preview",className:"modal-media"}),(0,c.jsxs)("div",{className:"modal-caption",children:[(0,c.jsx)("h4",{children:"Reel Thumbnail"}),(0,c.jsx)("p",{children:"This image will be used as the cover for your reel video."})]})]}),(0,c.jsx)("div",{className:"modal-footer",children:(0,c.jsx)("button",{onClick:()=>G(null),className:"ig-btn ig-btn-primary",children:"Close"})})]})})]})};function u(e){var s;let{post:t,onSave:i,onClose:l}=e;const[o,n]=(0,a.useState)({...t});return"scheduled"!==t.status?null:(0,c.jsx)("div",{className:"sph-modal",children:(0,c.jsxs)("div",{className:"sph-modal-content",children:[(0,c.jsx)("h3",{children:"Edit Scheduled Post"}),(0,c.jsx)("label",{children:"Caption"}),(0,c.jsx)("textarea",{value:o.prompt,onChange:e=>n({...o,prompt:e.target.value}),placeholder:"Enter post caption..."}),(0,c.jsx)("label",{children:"Post Type"}),(0,c.jsxs)("select",{value:o.post_type||"photo",onChange:e=>n({...o,post_type:e.target.value}),children:[(0,c.jsx)("option",{value:"photo",children:"Photo"}),(0,c.jsx)("option",{value:"carousel",children:"Carousel"}),(0,c.jsx)("option",{value:"reel",children:"Reel"})]}),(0,c.jsx)("label",{children:"Date & Time"}),(0,c.jsx)("input",{type:"datetime-local",value:null===(s=o.scheduled_datetime)||void 0===s?void 0:s.slice(0,16),onChange:e=>n({...o,scheduled_datetime:e.target.value})}),(0,c.jsxs)("div",{className:"sph-modal-actions",children:[(0,c.jsx)("button",{onClick:()=>i(o),children:"Save"}),(0,c.jsx)("button",{onClick:l,children:"Cancel"})]})]})})}const m=function(){const[e,s]=(0,a.useState)([]),[t,i]=(0,a.useState)(""),[o,n]=(0,a.useState)("scheduled_datetime"),[r,d]=(0,a.useState)(!0),[m,g]=(0,a.useState)(null),[h,p]=(0,a.useState)(null),[x,v]=(0,a.useState)(!1),[f,j]=(0,a.useState)("");(0,a.useEffect)(()=>{y()},[]);const y=async()=>{d(!0);try{const e=await l.A.getScheduledPosts();s(e)}catch(e){j("Failed to fetch scheduled posts.")}finally{d(!1)}},b=e=>{if(!e)return"N/A";const s=new Date(e);return s.toLocaleDateString("en-US",{day:"2-digit",month:"short",year:"numeric"})+", "+s.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})},w=[...e.filter(e=>e.prompt.toLowerCase().includes(t.toLowerCase())||e.status&&e.status.toLowerCase().includes(t.toLowerCase())||e.post_type&&e.post_type.toLowerCase().includes(t.toLowerCase()))].sort((e,s)=>{let t=e[o],a=s[o];return"scheduled_datetime"===o&&(t=new Date(t),a=new Date(a)),t<a?-1:t>a?1:0});return(0,c.jsxs)("div",{className:"scheduled-post-history",children:[(0,c.jsx)("h2",{children:"Scheduled Post History"}),(0,c.jsx)("div",{className:"sph-controls",children:(0,c.jsx)("input",{type:"text",placeholder:"Search by caption, status, or post type...",value:t,onChange:e=>i(e.target.value)})}),(0,c.jsxs)("table",{className:"sph-table",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{onClick:()=>n("prompt"),children:"Caption"}),(0,c.jsx)("th",{onClick:()=>n("post_type"),children:"Post Type"}),(0,c.jsx)("th",{onClick:()=>n("scheduled_datetime"),children:"Date & Time"}),(0,c.jsx)("th",{onClick:()=>n("status"),children:"Status"}),(0,c.jsx)("th",{children:"Actions"})]})}),(0,c.jsx)("tbody",{children:r?(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:5,children:"Loading..."})}):0===w.length?(0,c.jsx)("tr",{children:(0,c.jsx)("td",{colSpan:5,children:"No scheduled posts found."})}):w.map(e=>{const s=(e=>{if(!e)return{icon:(0,c.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,c.jsx)("polyline",{points:"14,2 14,8 20,8"})]}),label:"Unknown",class:"sph-post-type-unknown"};const s=e.toLowerCase();switch(s){case"photo":return{icon:(0,c.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,c.jsx)("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),(0,c.jsx)("polyline",{points:"21,15 16,10 5,21"})]}),label:"Photo",class:"sph-post-type-photo"};case"carousel":return{icon:(0,c.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),(0,c.jsx)("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),(0,c.jsx)("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),label:"Carousel",class:"sph-post-type-carousel"};case"reel":return{icon:(0,c.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("polygon",{points:"23 7 16 12 23 17 23 7"}),(0,c.jsx)("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})]}),label:"Reel",class:"sph-post-type-reel"};default:return{icon:(0,c.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,c.jsx)("polyline",{points:"14,2 14,8 20,8"})]}),label:s.charAt(0).toUpperCase()+s.slice(1),class:"sph-post-type-unknown"}}})(e.post_type);return(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{title:e.prompt,children:e.prompt.length>40?e.prompt.slice(0,40)+"...":e.prompt}),(0,c.jsx)("td",{children:(0,c.jsxs)("span",{className:`sph-post-type ${s.class}`,children:[(0,c.jsx)("span",{className:"sph-post-type-icon",children:s.icon}),(0,c.jsx)("span",{className:"sph-post-type-label",children:s.label})]})}),(0,c.jsx)("td",{children:b(e.scheduled_datetime)}),(0,c.jsx)("td",{children:(0,c.jsx)("span",{className:`sph-status sph-status-${e.status}`,children:e.status})}),(0,c.jsx)("td",{children:"scheduled"===e.status?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("button",{className:"sph-action-btn sph-edit",onClick:()=>(e=>{g(e)})(e),title:"Edit",children:(0,c.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M12 20h9"}),(0,c.jsx)("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"})]})}),(0,c.jsx)("button",{className:"sph-action-btn sph-delete",onClick:()=>(e=>{p(e),v(!0)})(e),title:"Delete",children:(0,c.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("polyline",{points:"3,6 5,6 21,6"}),(0,c.jsx)("path",{d:"M19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"})]})})]}):(0,c.jsx)("span",{className:"sph-no-actions",children:"No actions available"})})]},e.id)})})]}),f&&(0,c.jsx)("div",{className:"sph-message",children:f}),x&&(0,c.jsx)("div",{className:"sph-modal",children:(0,c.jsxs)("div",{className:"sph-modal-content",children:[(0,c.jsx)("p",{children:"Are you sure you want to delete this post?"}),(0,c.jsx)("button",{onClick:async()=>{try{await l.A.deleteScheduledPost(h.id),s(e.filter(e=>e.id!==h.id)),j("Post deleted.")}catch(t){j("Failed to delete post.")}finally{v(!1),p(null)}},children:"Yes, Delete"}),(0,c.jsx)("button",{onClick:()=>v(!1),children:"Cancel"})]})}),m&&(0,c.jsx)(u,{post:m,onSave:async t=>{try{await l.A.updateScheduledPost(t.id,t),s(e.map(e=>e.id===t.id?t:e)),j("Post updated.")}catch(a){j("Failed to update post.")}finally{g(null)}},onClose:()=>g(null)})]})},g=["image/png","image/jpeg","image/jpg"],h=["video/mp4","video/quicktime"],p=()=>{const e=(0,i.Zp)(),s=(0,i.zy)(),{isAuthenticated:t,loading:u,user:p}=(0,o.A)(),{addNotification:x,testNotification:v,testWebSocketConnection:f,testApiConnection:j,testSimpleWebSocket:y,refreshNotifications:b}=(0,n.E)(),[w,N]=(0,a.useState)(!1),[k,C]=(0,a.useState)([]),[S,I]=(0,a.useState)(""),[_,P]=(0,a.useState)("connect"),[D,A]=(0,a.useState)(!1),[F,E]=(0,a.useState)(null),[T,B]=(0,a.useState)(""),[U,G]=(0,a.useState)(!1),[$,R]=(0,a.useState)("photo"),[W,M]=(0,a.useState)(""),[L,z]=(0,a.useState)(""),[O,V]=(0,a.useState)(!1),[q,H]=(0,a.useState)(""),[K,Y]=(0,a.useState)("ai"),[J,Q]=(0,a.useState)(""),[Z,X]=(0,a.useState)(!1),[ee,se]=(0,a.useState)(null),[te,ae]=(0,a.useState)(!1),[ie,le]=(0,a.useState)(""),[oe,ne]=(0,a.useState)(!1),[re,ce]=(0,a.useState)(0),[de,ue]=(0,a.useState)({promptTemplate:"",brandName:"",hookIdea:"",features:"",location:"",phone:"",website:"",callToAction:"",imagePrompt:"",customStrategyTemplate:""}),[me,ge]=(0,a.useState)(!1),[he,pe]=(0,a.useState)([{id:"default",name:"Default Template",prompt:"Generate a catchy Instagram caption for this post."},{id:"product",name:"Product Showcase",prompt:"Create an engaging caption highlighting the key features and benefits of this product."},{id:"event",name:"Event Promotion",prompt:"Write an exciting caption to promote this event, including date, time, and location."},{id:"custom",name:"Custom Template",prompt:""}]),[xe,ve]=(0,a.useState)([]),[fe,je]=(0,a.useState)([]),[ye,be]=(0,a.useState)(3),[we,Ne]=(0,a.useState)(""),[ke,Ce]=(0,a.useState)(!1),[Se,Ie]=(0,a.useState)(null),[_e,Pe]=(0,a.useState)(null),[De,Ae]=(0,a.useState)(""),[Fe,Ee]=(0,a.useState)(""),[Te,Be]=(0,a.useState)(""),[Ue,Ge]=(0,a.useState)(!1),[$e,Re]=(0,a.useState)(!1),[We,Me]=(0,a.useState)(""),[Le,ze]=(0,a.useState)(!1),[Oe,Ve]=(0,a.useState)(null),[qe,He]=(0,a.useState)(""),[Ke,Ye]=(0,a.useState)(""),[Je,Qe]=(0,a.useState)([]),[Ze,Xe]=(0,a.useState)(!1),[es,ss]=(0,a.useState)(!1),[ts,as]=(0,a.useState)([]),[is,ls]=(0,a.useState)(!1),[os,ns]=(0,a.useState)(!1),[rs,cs]=(0,a.useState)(!1),[ds,us]=(0,a.useState)(!1),[ms,gs]=(0,a.useState)("Thank you for your comment! We appreciate your engagement. \ud83d\ude0a"),[hs,ps]=(0,a.useState)([]),[xs,vs]=(0,a.useState)([]),[fs,js]=(0,a.useState)(!1),[ys,bs]=(0,a.useState)(!1),[ws,Ns]=(0,a.useState)(!1),[ks,Cs]=(0,a.useState)(!1),[Ss,Is]=(0,a.useState)("Thanks for your message! I'll get back to you soon. \ud83d\ude0a"),[_s,Ps]=(0,a.useState)(!1),[Ds,As]=(0,a.useState)(!1),[Fs,Es]=(0,a.useState)(""),[Ts,Bs]=(0,a.useState)(""),[Us,Gs]=(0,a.useState)(!1),[$s,Rs]=(0,a.useState)(!1),[Ws,Ms]=(0,a.useState)(!1),Ls="697225659875731",[zs,Os]=(0,a.useState)(!1),[Vs,qs]=(0,a.useState)(!1),[Hs,Ks]=(0,a.useState)(""),[Ys,Js]=(0,a.useState)(null),[Qs,Zs]=(0,a.useState)(null),[Xs,et]=(0,a.useState)(!1),[st,tt]=(0,a.useState)({show:!1,message:"",type:"info"}),at=function(e){tt({show:!0,message:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info"}),setTimeout(()=>tt({show:!1,message:"",type:"info"}),3500)};(0,a.useEffect)(()=>{(async()=>{if(S)try{const e=await l.A.getGlobalInstagramAutoReplyStatus(S.platform_user_id);Os(!!e.enabled),Ks(e.enabled?"enabled":"disabled")}catch(e){Os(!1),Ks("disabled")}})()},[S]),(0,a.useEffect)(()=>{let e;const s=async()=>{if(S&&zs)try{const e=await l.A.getGlobalInstagramAutoReplyProgress(S.platform_user_id);e.success&&(Js(e.progress),Zs(null))}catch(e){Zs(e.message||JSON.stringify(e))}};return zs&&S?(s(),e=setInterval(s,3e3)):Js(null),()=>e&&clearInterval(e)},[zs,S]);const it=()=>{window.FB&&t&&window.FB.getLoginStatus(e=>{"connected"===e.status?(E(e.authResponse.accessToken),B("Instagram: Using existing Facebook login session"),lt(e.authResponse.accessToken)):B("Instagram: Please connect your Facebook account to continue")})};(0,a.useEffect)(()=>{t&&!u&&(0,r.xV)({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GOOGLE_DEVELOPER_KEY:"AIzaSyBrhx2_rqwr3LFnM9L_21KJQHc3g0nVznM",REACT_APP_INSTAGRAM_APP_ID:"697225659875731",REACT_APP_WS_URL:"wss://localhost:8000"}.REACT_APP_FACEBOOK_APP_ID||"697225659875731").then(()=>{it(),wt()})},[t,u]),(0,a.useEffect)(()=>{it(),(()=>{if(window.FB)return window.FB.init({appId:Ls,cookie:!0,xfbml:!0,version:"v18.0"}),A(!0),void it();window.fbAsyncInit=function(){window.FB.init({appId:Ls,cookie:!0,xfbml:!0,version:"v18.0"}),A(!0),it()},function(e,s,t){var a,i=e.getElementsByTagName(s)[0];e.getElementById(t)||((a=e.createElement(s)).id=t,a.src="https://connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(a,i))}(document,"script","facebook-jssdk")})()},[Ls,t]),(0,a.useEffect)(()=>{if(t){C([]),I(""),N(!1),P("connect"),B("");const e=localStorage.getItem("authToken");if(!e)return console.error("\ud83d\udd0d DEBUG: No auth token found in localStorage"),void B("Authentication token not found. Please log in again.");l.A.setToken(e),console.log("\ud83d\udd0d DEBUG: Token set for Instagram accounts request"),l.A.getInstagramAccounts().then(e=>{console.log("\ud83d\udd0d DEBUG: Successfully fetched Instagram accounts:",e),C(e)}).catch(e=>{console.error("\ud83d\udd0d DEBUG: Error fetching Instagram accounts:",e),e.message.includes("Could not validate credentials")?B("Your session has expired. Please log in again."):e.message.includes("Failed to fetch")?B("Unable to connect to server. Please check if the backend is running and try again."):B(`Error loading Instagram accounts: ${e.message}`)})}},[t]);const lt=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F;if(!t)return B("Please log in to your account first before connecting Instagram."),void G(!1);if(!e)return B("No access token available. Please log in with Facebook first."),void G(!1);G(!0);try{B("Fetching Instagram Business accounts...");await l.A.connectInstagram(e);const s=await l.A.getSocialAccounts(),t=s.filter(e=>"instagram"===e.platform).map(e=>({id:e.id,platform_user_id:e.platform_user_id,username:e.username,name:e.display_name||e.page_name,followers_count:e.follower_count||0,media_count:e.media_count||0,profile_picture_url:e.profile_picture_url}));C(t),N(!0),B(`Found ${t.length} Instagram Business account(s)!`),1===t.length&&(I(t[0]),ot(t[0].platform_user_id))}catch(s){B(s.message||"Unknown error occurred")}finally{G(!1)}},ot=async e=>{Xe(!0);try{var s;const t=await l.A.getInstagramMedia(e);Qe((null===t||void 0===t||null===(s=t.data)||void 0===s?void 0:s.media)||[])}catch(t){B(`Error loading media: ${t.message}`)}finally{Xe(!1)}},nt=async e=>{const s=e.target.files[0];if(s)if(g.includes(s.type)){console.log("\ud83d\udd0d DEBUG: Authentication check before upload"),console.log("\ud83d\udd0d DEBUG: isAuthenticated:",t),console.log("\ud83d\udd0d DEBUG: user:",p),console.log("\ud83d\udd0d DEBUG: apiClient token exists:",!!l.A.token),X(!0),B("Uploading image...");try{const e=await l.A.uploadImageToCloudinary(s);if(!(e&&e.success&&e.data&&e.data.url))throw new Error((null===e||void 0===e?void 0:e.error)||"Upload failed");Q(e.data.url),H(e.data.url),se(s),B("Image uploaded successfully!")}catch(a){console.error("\ud83d\udd0d DEBUG: Upload error details:",a),B(`Image upload failed: ${a.message}`)}finally{X(!1)}}else B("Please select a PNG or JPG image")},rt=async e=>{const s=Array.from(e.target.files);if(s.length<3||s.length>7)B("Please select 3 to 7 images.");else{Ce(!0),B("Uploading carousel images...");try{const e=[];for(const t of s){if(!g.includes(t.type))return B("All images must be PNG or JPG."),void Ce(!1);const s=await l.A.uploadImageToCloudinary(t);if(!(s&&s.success&&s.data&&s.data.url))throw new Error((null===s||void 0===s?void 0:s.error)||"Upload failed");e.push(s.data.url)}ve(e),B(`Uploaded ${e.length} images for carousel.`)}catch(t){B("Error uploading carousel images: "+t.message)}finally{Ce(!1)}}},ct=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},dt=()=>{Ie(null)},ut=async e=>{const s=e.target.files[0];if(s)if(h.includes(s.type)){Ge(!0),B("Uploading video...");try{var t;const e=await l.A.uploadVideoToCloudinary(s);if(console.log("Video upload response:",e),e&&e.success&&(e.url||null!==(t=e.data)&&void 0!==t&&t.url)){var a,i;const t=e.url||(null===(a=e.data)||void 0===a?void 0:a.url),l=e.filename||(null===(i=e.data)||void 0===i?void 0:i.filename);Ae(t),Ee(l||""),Pe(s),console.log("\ud83d\udd0d DEBUG: Video uploaded successfully:",{videoUrl:t,filename:l,res:e}),B("Video uploaded successfully!")}else{if(!(e&&e.data&&e.data.url))throw new Error((null===e||void 0===e?void 0:e.error)||(null===e||void 0===e?void 0:e.message)||"Upload failed");Ae(e.data.url),Ee(e.data.filename||""),Pe(s),B("Video uploaded successfully!")}}catch(o){console.error("Video upload error:",o),B("Error: "+(o.message||o.toString()))}finally{Ge(!1)}}else B("Only .mp4 or .mov files are allowed.")},mt=async()=>{cs(!0);try{const e=await l.A.getGoogleDriveAuthorizeUrl();if(e.consent_url){const s=window.open(e.consent_url,"google-drive-auth","width=500,height=600,scrollbars=yes,resizable=yes"),t=e=>{e.data.success?(ns(!0),B("Google Drive connected successfully!"),gt()):e.data.error&&B(`Google Drive authentication failed: ${e.data.error}`),window.removeEventListener("message",t),s&&s.close()};window.addEventListener("message",t)}else e.already_authenticated&&(ns(!0),B("Google Drive already authenticated!"),gt())}catch(e){B(`Google Drive authentication error: ${e.message}`)}finally{cs(!1)}},gt=async()=>{if(os){ls(!0);try{const e=await l.A.getGoogleDriveFiles("image/");e.success&&e.files?as(e.files):B("Failed to load Google Drive files")}catch(e){B(`Error loading Google Drive files: ${e.message}`)}finally{ls(!1)}}},ht=(e,s)=>{Es(e),Bs(s),As(!0)},pt=()=>{As(!1),Es(""),Bs(""),Gs(!1)},xt=async()=>{Gs(!0);try{if(!(await l.A.getGoogleDriveStatus()).authenticated){const e=await l.A.getGoogleDriveAuthorizeUrl();e.consent_url&&await ft(e.consent_url)}if(!(await l.A.getGoogleDriveStatus()).authenticated)throw new Error("Authentication was not completed successfully");if(Rs(!0),await vt(),"undefined"===typeof window.google||!window.google.picker)throw new Error("Google Picker API failed to load");const e=await l.A.getGoogleDriveAuth();(new window.google.picker.PickerBuilder).addView((new window.google.picker.DocsView).setIncludeFolders(!0).setSelectFolderEnabled(!1).setMimeTypes("photo"===Fs?"image/*":"video/*")).setOAuthToken(e.access_token).setDeveloperKey("AIzaSyBrhx2_rqwr3LFnM9L_21KJQHc3g0nVznM").setCallback(jt).enableFeature(window.google.picker.Feature.NAV_HIDDEN).enableFeature(window.google.picker.Feature.MULTISELECT_ENABLED,"carousel"===Ts).setTitle("carousel"===Ts?"Select multiple files from Google Drive":"Select a file from Google Drive").setSelectableMimeTypes("photo"===Fs?"image/*":"video/*").build().setVisible(!0)}catch(e){console.error("Error with Google Drive selection:",e),B(`Google Drive error: ${e.message}`)}finally{Gs(!1)}},vt=()=>new Promise((e,s)=>{if(window.google&&window.google.picker)return void e();const t=document.createElement("script");t.src="https://apis.google.com/js/api.js",t.onload=()=>{window.gapi?window.gapi.load("picker",()=>{e()}):s(new Error("Google API failed to load"))},t.onerror=s,document.head.appendChild(t)}),ft=e=>new Promise((s,t)=>{const a=window.open(e,"google-drive-auth","width=500,height=600,scrollbars=yes,resizable=yes"),i=e=>{e.data.success?(Rs(!0),B("Google Drive connected successfully!"),s()):e.data.error&&(B(`Google Drive authentication failed: ${e.data.error}`),t(new Error(e.data.error))),window.removeEventListener("message",i),a&&a.close()};window.addEventListener("message",i),setTimeout(()=>{window.removeEventListener("message",i),a&&a.close(),t(new Error("Authentication timeout"))},3e5)}),jt=async e=>{if(e.action===window.google.picker.Action.PICKED){const t=e.docs;try{if("carousel"===Ts){const e=[];for(const s of t){const t=await yt(s.id),a=new Blob([t],{type:s.mimeType}),i=new File([a],s.name,{type:s.mimeType});e.push(i)}rt({target:{files:e}})}else{const e=t[0],s=await yt(e.id),a=new Blob([s],{type:e.mimeType}),i=new File([a],e.name,{type:e.mimeType});"photo"===Fs?nt({target:{files:[i]}}):"video"===Fs&&ut({target:{files:[i]}})}pt(),B("File(s) selected from Google Drive successfully!")}catch(s){console.error("Error downloading file from Google Drive:",s),B("Failed to download file from Google Drive: "+s.message)}}},yt=async e=>{try{const s=await l.A.downloadGoogleDriveFile(e);if(s.success&&s.fileContent){const e=atob(s.fileContent),t=new Array(e.length);for(let s=0;s<e.length;s++)t[s]=e.charCodeAt(s);return new Uint8Array(t)}throw new Error(s.error||"Download failed")}catch(s){throw new Error(`Failed to download file: ${s.message}`)}},bt=async()=>{if(S)if("photo"!==$||q&&q.trim()||J&&J.trim())if("carousel"!==$||0!==xe.length)if("reel"!==$||De){G(!0),B("Creating Instagram post..."),x({type:"pre_posting",platform:"instagram",strategyName:"photo"===$?"Photo Post":"reel"===$?"Reel Post":"Carousel Post",message:`Preparing to publish your Instagram ${$} post...`,timestamp:(new Date).toISOString()});try{const s={instagram_user_id:S.platform_user_id,post_type:"photo"===$?"feed":"reel"===$?"reel":$,media_type:"reel"===$?"video":"image"};if("photo"===$){s.caption=W;const e="ai"===K?q:J;if(!e||!e.trim())return B("Please select or generate an image before creating a photo post"),void G(!1);s.image_url=e,console.log("\ud83d\udd0d DEBUG: Photo post options:",{postType:$,imageSource:K,aiImageUrl:q,uploadedImageUrl:J,finalImageUrl:s.image_url,caption:s.caption})}else{if("carousel"===$){const e=await l.A.postInstagramCarousel(S.platform_user_id,we,xe);return e.success?(B("Instagram carousel post created successfully!"),x({type:"success",platform:"instagram",strategyName:"Carousel Post",message:"Your Instagram carousel post was published successfully!",timestamp:(new Date).toISOString()}),ve([]),Ne(""),le(""),ae(!1),z(""),S&&ot(S.platform_user_id)):(B(`Failed to create carousel post: ${e.error}`),x({type:"failure",platform:"instagram",strategyName:"Carousel Post",message:`Failed to publish Instagram carousel post: ${e.error}`,timestamp:(new Date).toISOString()})),void G(!1)}"reel"===$&&(s.caption=Te,De&&De.trim().startsWith("http")?s.video_url=De:Fe&&Fe.trim()&&(s.video_filename=Fe),s.is_reel=!0,qe&&qe.trim()?s.thumbnail_url=qe:Ke&&Ke.trim()&&(s.thumbnail_filename=Ke),s.media_type="video","media_file"in s&&delete s.media_file,"media_filename"in s&&delete s.media_filename,"image_url"in s&&delete s.image_url,console.log("\ud83d\udd0d DEBUG: Reel post options:",s),console.log("\ud83d\udd0d DEBUG: Thumbnail state values:",{reelThumbnailUrl:qe,reelThumbnailFilename:Ke,hasThumbnailUrl:qe&&qe.trim(),hasThumbnailFilename:Ke&&Ke.trim()}))}const t=Object.fromEntries(Object.entries(s).filter(e=>{let[s,t]=e;return null!==t&&void 0!==t&&""!==t}));if("photo"===$&&!t.image_url)return B("Photo posts require an image. Please select or generate an image first."),void G(!1);if("reel"===$&&!t.video_url&&!t.video_filename)return B("Reel posts require a video. Please upload a video first."),void G(!1);console.log("\ud83d\udd0d DEBUG: Calling createUnifiedInstagramPost with:",{instagramUserId:S.platform_user_id,options:t,originalPostType:$,originalOptions:s,reelUrl:De,reelFilename:Fe}),console.log("\ud83d\udd0d DEBUG: Final thumbnail state before API call:",{reelThumbnailUrl:qe,reelThumbnailFilename:Ke,hasThumbnailUrl:qe&&qe.trim(),hasThumbnailFilename:Ke&&Ke.trim(),cleanOptionsHasThumbnail:t.thumbnail_url||t.thumbnail_filename});const a=await l.A.createUnifiedInstagramPost(S.platform_user_id,t);if(a.success){B("Instagram post created successfully!"),x({type:"success",platform:"instagram",strategyName:"photo"===$?"Photo Post":"reel"===$?"Reel Post":"Carousel Post",message:`Your Instagram ${$} post was published successfully!`,timestamp:(new Date).toISOString()}),M(""),Be(""),Me(""),Re(!1),H(""),Q(""),Ae(""),Ee(""),Pe(null),se(null),z(""),le(""),He(""),Ye(""),Ve(null),S&&ot(S.platform_user_id);try{const e=(await l.A.getSocialAccounts()).find(e=>e.id===S.id);e&&(I(e),C(s=>s.map(s=>s.id===e.id?e:s)))}catch(e){console.warn("Failed to refresh account info after post:",e)}}else{let e=`Failed to create post: ${a.error||"Unknown error"}`;a.details&&(e+=`\nDetails: ${"string"===typeof a.details?a.details:JSON.stringify(a.details)}`),B(e),x({type:"failure",platform:"instagram",strategyName:"photo"===$?"Photo Post":"reel"===$?"Reel Post":"Carousel Post",message:`Failed to publish Instagram ${$} post: ${a.error||"Unknown error"}`,timestamp:(new Date).toISOString()}),console.error("Instagram post error:",a)}}catch(s){console.error("Error creating Instagram post:",s),B(`Error creating post: ${s.message}`),x({type:"failure",platform:"instagram",strategyName:"photo"===$?"Photo Post":"reel"===$?"Reel Post":"Carousel Post",message:`Unexpected error creating Instagram ${$} post: ${s.message}`,timestamp:(new Date).toISOString()})}finally{G(!1)}}else B("Please upload a video for the reel");else B("Please generate or upload carousel images");else B("Please select or generate an image");else B("Please select an Instagram account first")},wt=async()=>{try{const e=await l.A.getGoogleDriveStatus();Rs(e.authenticated)}catch(e){console.error("Error checking Google Drive availability:",e),Rs(!1)}},Nt=async()=>{if(S)try{console.log("\ud83d\udd04 Loading DM auto-reply settings for Instagram account:",S.platform_user_id,S.username);const e=await l.A.getInstagramDmAutoReplyStatus(S.platform_user_id);console.log("\ud83d\udccb DM auto-reply status:",e),e.success?(Cs(e.enabled),console.log("\u2705 DM auto-reply status loaded:",e.enabled)):(Cs(!1),at("Failed to load DM auto-reply status: "+(e.error||"Unknown error"),"error"),console.log("\ud83d\udcdd No DM auto-reply status found"))}catch(e){Cs(!1),at("Error loading DM auto-reply settings: "+((null===e||void 0===e?void 0:e.message)||"Unknown error"),"error"),console.error("\u274c Error loading DM auto-reply settings:",e)}},kt=async()=>{if(S)try{bs(!0),console.log("\ud83d\udd04 Loading posts for auto-reply selection for Instagram account:",S.platform_user_id);const s=await l.A.getPosts("instagram");if(console.log("\ud83d\udccb All Instagram posts from database:",s),!s||!Array.isArray(s))throw new Error("Failed to load posts");{console.log("\ud83d\udd0d Selected account details:",{id:S.id,platform_user_id:S.platform_user_id,username:S.username});const t=s.filter(e=>{var s,t,a,i,l,o;const n=(null===(s=e.social_account)||void 0===s?void 0:s.id)===S.id,r=(null===(t=e.social_account)||void 0===t?void 0:t.platform_user_id)===S.platform_user_id,c=(null===(a=e.social_account)||void 0===a?void 0:a.username)===S.username,d=n||r||c;return console.log("\ud83d\udd0d Checking post:",{postId:e.id,postAccountId:null===(i=e.social_account)||void 0===i?void 0:i.id,postPlatformUserId:null===(l=e.social_account)||void 0===l?void 0:l.platform_user_id,postUsername:null===(o=e.social_account)||void 0===o?void 0:o.username,selectedAccountId:S.id,selectedPlatformUserId:S.platform_user_id,selectedUsername:S.username,matchesAccountId:n,matchesPlatformUserId:r,matchesUsername:c,isMatch:d}),d});if(console.log("\ud83d\udccb Posts for this account:",t.length),console.log("\ud83d\udccb All posts in database:",s.length),console.log("\ud83d\udccb Account posts details:",t.map(e=>{var s,t,a,i;return{id:e.id,content:(null===(s=e.content)||void 0===s?void 0:s.substring(0,50))+"...",social_account_id:null===(t=e.social_account)||void 0===t?void 0:t.id,platform_user_id:null===(a=e.social_account)||void 0===a?void 0:a.platform_user_id,username:null===(i=e.social_account)||void 0===i?void 0:i.username}})),0===t.length){console.log("\u26a0\ufe0f No posts found for this specific account. Showing all Instagram posts for debugging..."),ps(s),console.log("\ud83d\udccb Showing all Instagram posts for debugging:",s.length),console.log("\ud83d\udd04 Attempting to sync from Instagram...");try{const e=await l.A.syncInstagramPosts(S.platform_user_id);if(console.log("\ud83d\udce1 Sync response:",e),e.success){const e=await l.A.getPosts("instagram"),s=e.filter(e=>{var s,t,a;const i=(null===(s=e.social_account)||void 0===s?void 0:s.id)===S.id,l=(null===(t=e.social_account)||void 0===t?void 0:t.platform_user_id)===S.platform_user_id,o=(null===(a=e.social_account)||void 0===a?void 0:a.username)===S.username;return i||l||o});s.length>0?(ps(s),console.log("\u2705 Posts loaded after sync:",s.length)):(console.log("\u26a0\ufe0f Still no posts found after sync. Showing all posts for debugging."),ps(e),B("No posts found for this account. Showing all Instagram posts for debugging. Create some posts first using the Create Post tab."))}else B("Failed to sync posts from Instagram. Showing all posts for debugging.")}catch(e){console.error("\u274c Sync error:",e),B("Failed to sync posts from Instagram. Showing all posts for debugging.")}}else ps(t),console.log("\u2705 Posts loaded for auto-reply selection:",t.length)}}catch(s){console.error("\u274c Error loading posts for auto-reply:",s);let e="Failed to load posts for auto-reply selection";s.message.includes("404")?e="Instagram account not found. Please reconnect your Instagram account.":s.message.includes("401")?e="Authentication failed. Please log in again.":s.message.includes("500")&&(e="Server error. Please try again later."),B(e)}finally{bs(!1)}};(0,a.useEffect)(()=>{console.log("\ud83d\udd0d DEBUG: Auto-reply useEffect triggered"),console.log("\ud83d\udd0d DEBUG: selectedAccount:",S),console.log("\ud83d\udd0d DEBUG: activeTab:",_),S&&"auto-reply"===_&&(console.log("\ud83d\udd0d DEBUG: Loading auto-reply settings"),(async()=>{if(S)try{console.log("\ud83d\udd04 Loading auto-reply settings for Instagram account:",S.platform_user_id,S.username);const s=await l.A.getAutomationRules("instagram","auto_reply");console.log("\ud83d\udccb Found automation rules:",s);const t=s.find(e=>e.social_account_id===S.id&&"AUTO_REPLY"===e.rule_type);var e;t?(us(t.is_active),gs((null===(e=t.actions)||void 0===e?void 0:e.template)||""),console.log("\u2705 Found existing auto-reply rule:",t)):(us(!1),gs(""),console.log("\ud83d\udcdd No existing auto-reply rule found")),await kt()}catch(a){var s,t;console.error("\u274c Error loading auto-reply settings:",a);let e="Failed to load auto-reply settings";null!==(s=a.response)&&void 0!==s&&null!==(t=s.data)&&void 0!==t&&t.detail?e+=": "+a.response.data.detail:a.message&&(e+=": "+a.message),B(e)}})())},[S,_]),(0,a.useEffect)(()=>{if(S&&ds){(async()=>{try{const e=await l.A.getAutomationRules("instagram","auto_reply"),s=(await l.A.getSocialAccounts()).find(e=>"instagram"===e.platform&&e.platform_user_id===S.platform_user_id);if(s){const t=e.find(e=>e.social_account_id===s.id&&"AUTO_REPLY"===e.rule_type);t&&t.is_active||(us(!1),vs([]))}}catch(e){console.error("Error validating auto-reply state:",e)}})()}},[S,ds]),(0,a.useEffect)(()=>{S&&"post"===_&&ot(S.platform_user_id)},[S,_]),(0,a.useEffect)(()=>{S&&"auto-reply"===_&&Nt()},[S,_]),(0,a.useEffect)(()=>{S&&Nt()},[S]);const[Ct,St]=(0,a.useState)([]);return(0,a.useEffect)(()=>{s.state&&s.state.scheduledGridRows&&St(s.state.scheduledGridRows)},[s.state]),(0,a.useEffect)(()=>{let e;const s=async()=>{try{const e=await l.A.getScheduledPosts();St(e.filter(e=>"instagram"===e.platform))}catch(e){}};return s(),e=setInterval(s,1e4),()=>clearInterval(e)},[]),u?(0,c.jsx)("div",{className:"instagram-container",children:(0,c.jsxs)("div",{className:"loading-screen",children:[(0,c.jsx)("div",{className:"loading-spinner"}),(0,c.jsx)("p",{children:"Checking authentication..."})]})}):t?D?(0,c.jsxs)("div",{className:"instagram-container",children:[(0,c.jsxs)("div",{className:"header-section",children:[(0,c.jsx)("button",{onClick:()=>e("/"),className:"back-button",children:"Back to Dashboard"}),(0,c.jsxs)("div",{className:"header-content",children:[(0,c.jsx)("div",{className:"header-icon",children:(0,c.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,c.jsx)("rect",{x:"2",y:"2",width:"20",height:"20",rx:"5",ry:"5",stroke:"currentColor",strokeWidth:"2"}),(0,c.jsx)("path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",stroke:"currentColor",strokeWidth:"2"}),(0,c.jsx)("line",{x1:"17.5",y1:"6.5",x2:"17.51",y2:"6.5",stroke:"currentColor",strokeWidth:"2"})]})}),(0,c.jsxs)("div",{className:"header-text",children:[(0,c.jsx)("h1",{children:"Instagram Management"}),(0,c.jsx)("p",{children:"Connect and manage your Instagram Business accounts"})]})]})]}),w&&S&&(0,c.jsxs)("div",{className:"global-auto-reply-section",style:{display:"flex",alignItems:"center",justifyContent:"space-between",background:"#fff",borderRadius:12,boxShadow:"0 2px 8px rgba(0,0,0,0.04)",padding:"18px 24px",marginBottom:18,border:"1px solid #eee",flexWrap:"wrap",gap:16},children:[(0,c.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,c.jsx)("div",{style:{width:56,height:56,borderRadius:"50%",overflow:"hidden",background:"#f3f3f3",border:"1px solid #e0e0e0"},children:S.profile_picture_url?(0,c.jsx)("img",{src:S.profile_picture_url,alt:S.username,style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,c.jsx)("div",{style:{width:"100%",height:"100%",background:"#eee"}})}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("div",{style:{fontWeight:600,fontSize:18},children:["@",S.username]}),(0,c.jsx)("div",{style:{color:"#888",fontSize:14},children:S.name}),(0,c.jsxs)("div",{style:{color:"#666",fontSize:13,marginTop:2},children:[(0,c.jsxs)("span",{style:{marginRight:12},children:[(0,c.jsx)("b",{children:S.followers_count})," followers"]}),(0,c.jsxs)("span",{children:[(0,c.jsx)("b",{children:S.media_count})," posts"]})]})]})]}),(0,c.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16},children:[(0,c.jsxs)("button",{className:"auto-reply-toggle-btn",onClick:async()=>{if(S){qs(!0),Zs(null);try{if(zs){const e=await l.A.disableGlobalInstagramAutoReply(S.platform_user_id);e.success?(Os(!1),Ks("disabled"),at("Auto-reply disabled.","info")):(Zs(e.error||"Failed to disable auto-reply."),at("Failed to disable auto-reply: "+(e.error||"Unknown error"),"error"))}else{const e=await l.A.enableGlobalInstagramAutoReply(S.platform_user_id);e.success?(Os(!0),Ks("enabled"),at("Auto-reply enabled for all posts and comments!","success")):(Zs(e.error||"Failed to enable auto-reply."),at("Failed to enable auto-reply: "+(e.error||"Unknown error"),"error"))}}catch(e){Zs(e.message||JSON.stringify(e)),at("Error: "+(e.message||e.toString()),"error")}finally{qs(!1)}}else at("Please select an Instagram account first.","error")},disabled:Vs,style:{display:"flex",alignItems:"center",gap:10,fontWeight:600,background:zs?"#38c172":"#e0e0e0",color:zs?"#fff":"#444",border:"none",borderRadius:20,padding:"10px 22px",fontSize:16,cursor:Vs?"not-allowed":"pointer",boxShadow:zs?"0 2px 8px rgba(56,193,114,0.08)":"none",transition:"background 0.2s"},children:[(0,c.jsx)("span",{style:{display:"inline-block",width:14,height:14,borderRadius:"50%",background:zs?"#2ecc40":"#bbb",marginRight:6,border:zs?"2px solid #fff":"2px solid #ccc",boxShadow:zs?"0 0 4px #38c172":"none",verticalAlign:"middle"}}),"Auto Comment Reply: ",zs?"Enabled":"Disabled",Vs&&(0,c.jsx)("span",{className:"loading-spinner",style:{marginLeft:10,width:18,height:18,border:"2px solid #fff",borderTop:"2px solid #38c172",borderRadius:"50%",display:"inline-block",animation:"spin 1s linear infinite"}})]}),(0,c.jsxs)("button",{className:"auto-reply-toggle-btn",onClick:async()=>{if(S){Ps(!0);try{const e=await l.A.toggleInstagramDmAutoReply(S.platform_user_id,!ks);e.success?(Cs(!ks),at(ks?"Auto DM Reply disabled successfully.":"Auto DM Reply enabled successfully!","success")):(at("Failed to toggle Auto DM Reply: "+(e.error||"Unknown error"),"error"),console.error("\u274c Failed to toggle Auto DM Reply:",e))}catch(e){at("Failed to toggle Auto DM Reply: "+((null===e||void 0===e?void 0:e.message)||"Unknown error"),"error"),console.error("\u274c Error toggling Auto DM Reply:",e)}finally{Ps(!1)}}else at("Please select an Instagram account first.","error")},disabled:_s,style:{display:"flex",alignItems:"center",gap:10,fontWeight:600,background:ks?"#38c172":"#e0e0e0",color:ks?"#fff":"#444",border:"none",borderRadius:20,padding:"10px 22px",fontSize:16,cursor:_s?"not-allowed":"pointer",boxShadow:ks?"0 2px 8px rgba(56,193,114,0.08)":"none",transition:"background 0.2s"},children:[(0,c.jsx)("span",{style:{display:"inline-block",width:14,height:14,borderRadius:"50%",background:ks?"#2ecc40":"#bbb",marginRight:6,border:ks?"2px solid #fff":"2px solid #ccc",boxShadow:ks?"0 0 4px #38c172":"none",verticalAlign:"middle"}}),"Auto DM Reply: ",ks?"Enabled":"Disabled",_s&&(0,c.jsx)("span",{className:"loading-spinner",style:{marginLeft:10,width:18,height:18,border:"2px solid #fff",borderTop:"2px solid #38c172",borderRadius:"50%",display:"inline-block",animation:"spin 1s linear infinite"}})]})]})]}),T&&(0,c.jsx)("div",{className:"status-message info",children:(0,c.jsx)("span",{className:"message-text",children:T})}),(0,c.jsxs)("div",{className:"main-content",children:[(0,c.jsxs)("div",{className:"tab-navigation",children:[(0,c.jsxs)("button",{className:"tab-button "+("connect"===_?"active":""),onClick:()=>P("connect"),children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),(0,c.jsx)("circle",{cx:"9",cy:"7",r:"4"}),(0,c.jsx)("path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}),(0,c.jsx)("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),"Connect Account"]}),(0,c.jsxs)("button",{className:"tab-button "+("post"===_?"active":""),onClick:()=>P("post"),disabled:!w,children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M12 20h9"}),(0,c.jsx)("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"})]}),"Create Post"]}),(0,c.jsxs)("button",{className:"tab-button "+("media"===_?"active":""),onClick:()=>P("media"),disabled:!w||!S,children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,c.jsx)("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),(0,c.jsx)("polyline",{points:"21,15 16,10 5,21"})]}),"Media Gallery"]}),(0,c.jsxs)("button",{className:"tab-button "+("bulk-composer"===_?"active":""),onClick:()=>P("bulk-composer"),disabled:!w||!S,children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("rect",{x:"3",y:"3",width:"7",height:"7"}),(0,c.jsx)("rect",{x:"14",y:"3",width:"7",height:"7"}),(0,c.jsx)("rect",{x:"14",y:"14",width:"7",height:"7"}),(0,c.jsx)("rect",{x:"3",y:"14",width:"7",height:"7"})]}),"Bulk Composer"]}),(0,c.jsxs)("button",{className:"tab-button "+("scheduled-posts"===_?"active":""),onClick:()=>P("scheduled-posts"),disabled:!w||!S,children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,c.jsx)("polyline",{points:"12,6 12,12 16,14"})]}),"Scheduled Posts"]})]}),(0,c.jsxs)("div",{className:"tab-content",children:["connect"===_&&(0,c.jsx)("div",{className:"connect-section",children:w?(0,c.jsxs)("div",{className:"connected-accounts",children:[(0,c.jsxs)("div",{className:"accounts-header",children:[(0,c.jsx)("h2",{children:"Connected Instagram Accounts"}),(0,c.jsx)("button",{onClick:()=>{C([]),I(""),N(!1),P("connect"),B("Instagram accounts disconnected")},className:"logout-button",children:"Disconnect"})]}),(0,c.jsx)("div",{className:"accounts-grid",children:k.map(e=>(0,c.jsxs)("div",{className:"account-card "+(S.id===e.id?"selected":""),onClick:()=>I(e),children:[(0,c.jsx)("div",{className:"account-avatar",children:e.profile_picture_url?(0,c.jsx)("img",{src:e.profile_picture_url,alt:e.username}):(0,c.jsx)("div",{className:"avatar-placeholder"})}),(0,c.jsxs)("div",{className:"account-info",children:[(0,c.jsxs)("h3",{children:["@",e.username]}),(0,c.jsx)("p",{children:e.name}),(0,c.jsxs)("div",{className:"account-stats",children:[(0,c.jsxs)("span",{children:[e.followers_count," followers"]}),(0,c.jsxs)("span",{children:[e.media_count," posts"]})]})]}),S.id===e.id&&(0,c.jsx)("div",{className:"selected-indicator"})]},e.id))})]}):(0,c.jsxs)("div",{className:"connection-card",children:[(0,c.jsx)("div",{className:"connection-icon"}),(0,c.jsx)("h2",{children:"Connect Instagram Account"}),(0,c.jsx)("p",{children:"Connect your Instagram Business account through Facebook to start posting and managing content."}),(0,c.jsx)("button",{onClick:()=>{window.FB?(G(!0),B("Initiating Instagram OAuth via Facebook..."),window.FB.login(e=>{if("connected"===e.status){const s=e.authResponse.accessToken;E(s),B("Facebook login successful! Connecting Instagram accounts..."),lt(s)}else B("Facebook login failed or was cancelled"),G(!1)},{scope:"pages_show_list,instagram_basic,instagram_content_publish,pages_read_engagement, business_management"})):B("Facebook SDK not loaded")},disabled:U,className:"connect-main-button",children:U?"Connecting...":"Connect via Facebook"}),(0,c.jsxs)("div",{className:"requirements-card",children:[(0,c.jsx)("h3",{children:"Requirements"}),(0,c.jsxs)("ul",{children:[(0,c.jsx)("li",{children:"Instagram Business or Creator account"}),(0,c.jsx)("li",{children:"Connected to a Facebook Page"}),(0,c.jsx)("li",{children:"Admin access to the Facebook Page"})]})]})]})}),"post"===_&&S&&(0,c.jsxs)("div",{className:"post-section",children:[(0,c.jsxs)("div",{className:"post-type-toggle",children:[(0,c.jsxs)("button",{className:"photo"===$?"active":"",onClick:()=>R("photo"),children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,c.jsx)("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),(0,c.jsx)("polyline",{points:"21,15 16,10 5,21"})]}),"Photo"]}),(0,c.jsxs)("button",{className:"carousel"===$?"active":"",onClick:()=>R("carousel"),children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),(0,c.jsx)("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),(0,c.jsx)("line",{x1:"12",y1:"17",x2:"12",y2:"21"})]}),"Carousel"]}),(0,c.jsxs)("button",{className:"reel"===$?"active":"",onClick:()=>R("reel"),children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("polygon",{points:"23 7 16 12 23 17 23 7"}),(0,c.jsx)("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})]}),"Reel"]})]}),"photo"===$&&(0,c.jsxs)("div",{className:"post-card",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Image Source"}),(0,c.jsxs)("div",{className:"image-source-toggle",children:[(0,c.jsx)("button",{className:"ai"===K?"active":"",onClick:()=>Y("ai"),children:"AI"}),(0,c.jsx)("button",{className:"upload"===K?"active":"",onClick:()=>Y("upload"),children:"Upload"})]})]}),"ai"===K&&(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"AI Prompt"}),(0,c.jsx)("textarea",{value:L,onChange:e=>{z(e.target.value),q&&H(""),W&&!W.trim().includes("Check out this amazing image!")&&M("")},placeholder:"Describe your image...",rows:3,className:"post-textarea"}),(0,c.jsxs)("div",{className:"ai-buttons",children:[(0,c.jsx)("button",{className:"ai-generate-button",onClick:async()=>{if(L.trim()){V(!0),B("Generating Instagram-optimized image with AI...");try{console.log("\ud83d\udd0d DEBUG: Generating Instagram image with prompt:",L.trim());const e=await l.A.generateInstagramImage(L.trim());if(console.log("\ud83d\udd0d DEBUG: Image generation response:",e),e&&e.success&&e.data&&e.data.image_url){H(e.data.image_url);const s=e.data.width&&e.data.height?`(${e.data.width}x${e.data.height})`:"";B(`AI image generated successfully! ${s}`),console.log("\ud83d\udd0d DEBUG: Generated image URL:",e.data.image_url),console.log("\ud83d\udd0d DEBUG: Image dimensions:",e.data.width,"x",e.data.height),console.log("\ud83d\udd0d DEBUG: Enhanced prompt:",e.data.enhanced_prompt)}else e&&e.data&&e.data.image_url?(H(e.data.image_url),B("AI image generated successfully!"),console.log("\ud83d\udd0d DEBUG: Generated image URL (fallback):",e.data.image_url)):(console.error("\ud83d\udd0d DEBUG: Invalid response format:",e),B("Failed to generate image. Please try again."))}catch(e){console.error("\ud83d\udd0d DEBUG: Image generation error:",e);let s=e.message||e.toString();if(s.includes("401")||s.includes("Unauthorized"))s="Invalid or expired Stability AI API key. Please check your API key in the backend configuration.";else if(s.includes("429")||s.includes("Too Many Requests")){s="Rate limit exceeded. Please wait a few minutes before trying again, or upgrade your Stability AI plan.",ce(300);const e=setInterval(()=>{ce(s=>s<=1?(clearInterval(e),0):s-1)},1e3)}else s.includes("500")||s.includes("Internal Server Error")?s="Server error occurred. Please try again in a moment.":s.includes("timeout")&&(s="Request timed out. Please try again.");B("Error generating image: "+s)}finally{V(!1)}}else B("Please enter a prompt for image generation.")},disabled:O||!L.trim()||re>0,children:O?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"spinning",children:(0,c.jsx)("path",{d:"M21 12a9 9 0 11-6.219-8.56"})}),"Generating..."]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,c.jsx)("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),"Generate Image"]})}),(0,c.jsx)("button",{className:"ai-generate-button secondary",onClick:async()=>{if(L.trim()){V(!0),ne(!0),B("Generating Instagram-optimized image and caption with AI...");try{console.log("\ud83d\udd0d DEBUG: Generating image and caption with prompt:",L.trim());const e=await l.A.generateInstagramImage(L.trim());if(console.log("\ud83d\udd0d DEBUG: Image generation response:",e),!e||!e.success||!e.data||!e.data.image_url)throw new Error("Failed to generate image");H(e.data.image_url),console.log("\ud83d\udd0d DEBUG: Generated image URL:",e.data.image_url),console.log("\ud83d\udd0d DEBUG: Image dimensions:",e.data.width,"x",e.data.height);const s=await l.A.generateInstagramCaption(L.trim());console.log("\ud83d\udd0d DEBUG: Caption generation response:",s),s&&s.success&&s.data&&s.data.content?(M(s.data.content),console.log("\ud83d\udd0d DEBUG: Generated caption:",s.data.content)):s&&s.content?(M(s.content),console.log("\ud83d\udd0d DEBUG: Generated caption (fallback):",s.content)):(console.warn("\ud83d\udd0d DEBUG: Caption generation failed, using fallback"),M(`Check out this amazing image! ${L.trim()}`));const t=e.data.width&&e.data.height?`(${e.data.width}x${e.data.height})`:"";B(`Image and caption generated successfully! ${t}`)}catch(e){console.error("\ud83d\udd0d DEBUG: Image and caption generation error:",e);let s=e.message||e.toString();if(s.includes("401")||s.includes("Unauthorized"))s="Invalid or expired Stability AI API key. Please check your API key in the backend configuration.";else if(s.includes("429")||s.includes("Too Many Requests")){s="Rate limit exceeded. Please wait a few minutes before trying again, or upgrade your Stability AI plan.",ce(300);const e=setInterval(()=>{ce(s=>s<=1?(clearInterval(e),0):s-1)},1e3)}else s.includes("500")||s.includes("Internal Server Error")?s="Server error occurred. Please try again in a moment.":s.includes("timeout")&&(s="Request timed out. Please try again.");B("Error generating image and caption: "+s),H(""),M("")}finally{V(!1),ne(!1)}}else B("Please enter a prompt for generation.")},disabled:O||oe||!L.trim()||re>0,children:O||oe?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"spinning",children:(0,c.jsx)("path",{d:"M21 12a9 9 0 11-6.219-8.56"})}),"Generating..."]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,c.jsx)("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,c.jsx)("polyline",{points:"14,2 14,8 20,8"}),(0,c.jsx)("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),(0,c.jsx)("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]}),"Generate Image & Caption"]})}),T&&T.includes("Error")&&L.trim()&&(0,c.jsx)("button",{className:"ai-generate-button retry",onClick:async()=>{if(L.trim()){V(!0),B("Retrying image generation...");try{console.log("\ud83d\udd0d DEBUG: Retrying image generation with prompt:",L.trim());const e=await l.A.generateInstagramImage(L.trim());console.log("\ud83d\udd0d DEBUG: Retry image generation response:",e),e&&e.success&&e.data&&e.data.image_url?(H(e.data.image_url),B("Image generated successfully on retry!"),console.log("\ud83d\udd0d DEBUG: Generated image URL (retry):",e.data.image_url)):e&&e.data&&e.data.image_url?(H(e.data.image_url),B("Image generated successfully on retry!"),console.log("\ud83d\udd0d DEBUG: Generated image URL (retry fallback):",e.data.image_url)):(console.error("\ud83d\udd0d DEBUG: Invalid response format on retry:",e),B("Failed to generate image on retry. Please try again."))}catch(e){console.error("\ud83d\udd0d DEBUG: Retry image generation error:",e);let s=e.message||e.toString();if(s.includes("401")||s.includes("Unauthorized"))s="Invalid or expired Stability AI API key. Please check your API key in the backend configuration.";else if(s.includes("429")||s.includes("Too Many Requests")){s="Rate limit exceeded. Please wait a few minutes before trying again, or upgrade your Stability AI plan.",ce(300);const e=setInterval(()=>{ce(s=>s<=1?(clearInterval(e),0):s-1)},1e3)}else s.includes("500")||s.includes("Internal Server Error")?s="Server error occurred. Please try again in a moment.":s.includes("timeout")&&(s="Request timed out. Please try again.");B("Error retrying image generation: "+s)}finally{V(!1)}}else B("Please enter a prompt for image generation.")},disabled:O||re>0,children:O?"Retrying...":"Retry Generation"})]}),re>0&&(0,c.jsxs)("div",{style:{color:"#e53e3e",marginTop:8,fontWeight:500},children:["Too many requests. Please wait ",Math.floor(re/60),":",(re%60).toString().padStart(2,"0")," before trying again."]})]}),"upload"===K&&(0,c.jsxs)("div",{className:"form-group image-upload",children:[(0,c.jsx)("label",{children:"Select Image"}),(0,c.jsx)("button",{type:"button",onClick:()=>ht("photo","manual"),className:"file-picker-button",disabled:Z,children:Z?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"spinning",children:(0,c.jsx)("path",{d:"M21 12a9 9 0 11-6.219-8.56"})}),"Uploading..."]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,c.jsx)("polyline",{points:"7,10 12,15 17,10"}),(0,c.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Choose Image"]})}),J&&(0,c.jsx)("div",{className:"image-preview",children:(0,c.jsx)("img",{src:J,alt:"Preview",className:"preview-image"})})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Caption"}),(0,c.jsxs)("div",{className:"caption-section",children:[(0,c.jsx)("div",{className:"caption-toggle",children:(0,c.jsxs)("label",{className:"toggle-label",children:[(0,c.jsx)("input",{type:"checkbox",checked:te,onChange:e=>ae(e.target.checked)}),(0,c.jsx)("span",{className:"toggle-text",children:"Auto Generate Caption"})]})}),te?(0,c.jsxs)("div",{className:"caption-prompt-section",children:[(0,c.jsx)("textarea",{value:ie,onChange:e=>le(e.target.value),placeholder:"Describe what you want in the caption...",rows:2,className:"caption-prompt-textarea"}),(0,c.jsx)("button",{onClick:async()=>{if(ie.trim()){ne(!0),B("Generating caption with AI...");try{console.log("\ud83d\udd0d DEBUG: Generating Instagram caption with prompt:",ie.trim());const e=await l.A.generateInstagramCaption(ie.trim());console.log("\ud83d\udd0d DEBUG: Caption generation response:",e),e&&e.success&&e.data&&e.data.content?(M(e.data.content),B("Caption generated successfully!"),console.log("\ud83d\udd0d DEBUG: Generated caption:",e.data.content)):e&&e.content?(M(e.content),B("Caption generated successfully!"),console.log("\ud83d\udd0d DEBUG: Generated caption (fallback):",e.content)):(console.error("\ud83d\udd0d DEBUG: Invalid response format:",e),B("Failed to generate caption. Please try again."))}catch(e){console.error("\ud83d\udd0d DEBUG: Caption generation error:",e),B("Error generating caption: "+(e.message||e.toString()))}finally{ne(!1)}}else B("Please enter a prompt for caption generation.")},disabled:oe||!ie.trim(),className:"generate-caption-button",children:oe?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"spinning",children:(0,c.jsx)("path",{d:"M21 12a9 9 0 11-6.219-8.56"})}),"Generating..."]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,c.jsx)("polyline",{points:"14,2 14,8 20,8"}),(0,c.jsx)("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),(0,c.jsx)("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]}),"Generate Caption"]})})]}):null,(0,c.jsx)("textarea",{value:W,onChange:e=>M(e.target.value),placeholder:te&&!W?"Caption will be generated...":"Write your caption...",rows:3,className:"post-textarea",disabled:te&&!W})]})]}),(q||J)&&(0,c.jsx)("div",{className:"generated-image",children:(0,c.jsx)("img",{src:q||J,alt:"Preview"})}),(0,c.jsx)("button",{className:"publish-button",onClick:bt,disabled:U||!(q||J)||!W.trim()&&!te,children:U?"Publishing...":"Publish Post"})]}),"carousel"===$&&(0,c.jsxs)("div",{className:"post-card",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Carousel Mode"}),(0,c.jsxs)("div",{className:"image-source-toggle",children:[(0,c.jsxs)("button",{className:"ai"===K?"active":"",onClick:()=>Y("ai"),disabled:ke,children:[(0,c.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,c.jsx)("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),"AI Generation"]}),(0,c.jsxs)("button",{className:"upload"===K?"active":"",onClick:()=>Y("upload"),disabled:ke,children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,c.jsx)("polyline",{points:"7,10 12,15 17,10"}),(0,c.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Manual Upload"]})]})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsxs)("label",{children:["Number of Images: ",ye]}),(0,c.jsx)("input",{type:"range",min:"3",max:"7",value:ye,onChange:e=>be(parseInt(e.target.value)),className:"slider",disabled:ke}),(0,c.jsxs)("div",{className:"slider-labels",children:[(0,c.jsx)("span",{children:"3"}),(0,c.jsx)("span",{children:"4"}),(0,c.jsx)("span",{children:"5"}),(0,c.jsx)("span",{children:"6"}),(0,c.jsx)("span",{children:"7"})]})]}),"ai"===K&&(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"AI Prompt for Carousel"}),(0,c.jsx)("textarea",{value:L,onChange:e=>z(e.target.value),placeholder:"Describe the carousel content you want to generate...",rows:"3",className:"post-textarea",disabled:ke}),(0,c.jsx)("div",{className:"ai-generation-note",children:(0,c.jsxs)("small",{children:[(0,c.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginRight:"4px",verticalAlign:"middle"},children:[(0,c.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,c.jsx)("path",{d:"M12 16v-4"}),(0,c.jsx)("path",{d:"M12 8h.01"})]}),"Tip: Carousel generation takes 3-5 minutes for ",ye," images. Please be patient!"]})}),(0,c.jsx)("button",{className:"generate-button",onClick:async()=>{if(L.trim()){Ce(!0),B(`Generating ${ye} carousel images with AI... This may take 3-5 minutes.`);try{const e=await l.A.generateInstagramCarousel(L.trim(),ye);e&&e.success&&e.image_urls?(ve(e.image_urls),Ne(e.caption||""),B(`AI carousel generated successfully with ${e.image_urls.length} images!`)):B(e.error||"Failed to generate carousel images.")}catch(e){console.error("Carousel generation error:",e),e.message&&e.message.includes("timeout")?B("Carousel generation timed out. This can happen with complex prompts or when generating many images. Please try again with a simpler prompt or fewer images."):B("Error generating carousel: "+(e.message||e.toString()))}finally{Ce(!1)}}else B("Please enter a prompt for carousel generation.")},disabled:ke||!L.trim(),children:ke?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"button-spinner"}),"Generating ",ye," Images..."]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,c.jsx)("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),"Generate Carousel"]})})]}),"upload"===K&&(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Upload Images (JPG/PNG)"}),(0,c.jsx)("button",{type:"button",onClick:()=>ht("photo","carousel"),className:"file-picker-button",disabled:ke,children:ke?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"button-spinner"}),"Uploading..."]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,c.jsx)("polyline",{points:"7,10 12,15 17,10"}),(0,c.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),"Select ",ye," Images"]})}),(0,c.jsxs)("p",{className:"file-upload-hint",children:["Select ",ye," images for your carousel"]})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Caption"}),(0,c.jsxs)("div",{className:"caption-section",children:[(0,c.jsx)("div",{className:"caption-toggle",children:(0,c.jsxs)("label",{className:"toggle-label",children:[(0,c.jsx)("input",{type:"checkbox",checked:te,onChange:e=>ae(e.target.checked)}),(0,c.jsx)("span",{className:"toggle-text",children:"Auto Generate Caption"})]})}),te?(0,c.jsxs)("div",{className:"caption-prompt-section",children:[(0,c.jsx)("textarea",{value:ie,onChange:e=>le(e.target.value),placeholder:"Describe what you want in the caption...",rows:2,className:"caption-prompt-textarea"}),(0,c.jsx)("button",{onClick:async()=>{if(ie.trim()){ne(!0),B("Generating carousel caption...");try{const e=await l.A.generateInstagramCaption(ie.trim());e.success&&e.content?(Ne(e.content),B("Caption generated successfully!")):B("Failed to generate caption: "+(e.error||"Unknown error"))}catch(e){B("Error generating caption: "+e.message)}finally{ne(!1)}}else B("Please provide a prompt for caption generation.")},disabled:oe||!ie.trim(),className:"generate-caption-button",children:oe?"Generating...":"Generate Caption"})]}):null,(0,c.jsx)("textarea",{value:we,onChange:e=>Ne(e.target.value),placeholder:te&&!we?"Caption will be generated...":"Write your caption...",rows:3,className:"post-textarea",disabled:te&&!we})]})]}),xe.length>0&&(0,c.jsxs)("div",{className:"carousel-preview-section",children:[(0,c.jsxs)("h4",{children:["Carousel Preview ",(0,c.jsx)("span",{className:"drag-hint",children:"(Drag to reorder)"})]}),(0,c.jsx)("div",{className:"carousel-preview-grid",children:xe.slice(0,ye).map((e,s)=>(0,c.jsxs)("div",{className:"carousel-preview-item "+(Se===s?"dragging":""),draggable:!0,onDragStart:e=>((e,s)=>{Ie(s),e.dataTransfer.effectAllowed="move"})(e,s),onDragOver:ct,onDrop:e=>((e,s)=>{if(e.preventDefault(),null===Se||Se===s)return void Ie(null);const t=[...xe],a=t[Se];t.splice(Se,1),t.splice(s,0,a),ve(t),Ie(null)})(e,s),onDragEnd:dt,children:[(0,c.jsx)("img",{src:e,alt:`Carousel item ${s+1}`}),(0,c.jsx)("span",{className:"carousel-item-number",children:s+1}),(0,c.jsx)("div",{className:"drag-handle",children:(0,c.jsxs)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("circle",{cx:"9",cy:"12",r:"1"}),(0,c.jsx)("circle",{cx:"9",cy:"5",r:"1"}),(0,c.jsx)("circle",{cx:"9",cy:"19",r:"1"}),(0,c.jsx)("circle",{cx:"15",cy:"12",r:"1"}),(0,c.jsx)("circle",{cx:"15",cy:"5",r:"1"}),(0,c.jsx)("circle",{cx:"15",cy:"19",r:"1"})]})}),xe.length>3&&(0,c.jsx)("button",{className:"remove-image-btn",onClick:e=>{e.stopPropagation(),(e=>{const s=xe.filter((s,t)=>t!==e);ve(s),s.length<ye&&be(Math.max(3,s.length))})(s)},title:"Remove image",children:(0,c.jsxs)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,c.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]},s))})]}),(0,c.jsx)("button",{className:"publish-button",onClick:async()=>{if(S)if(xe.length<3)B("Please add at least 3 images for carousel.");else if(we.trim()||te)if(!te||ie.trim()){G(!0),B("Publishing carousel post...");try{const e=te&&ie.trim()?await(async()=>(await l.A.generateInstagramCaption(ie.trim())).content||we||"Check out this amazing carousel!")():we,s=await l.A.postInstagramCarousel(S.platform_user_id,e,xe.slice(0,ye));s.success?(B("Carousel post published successfully!"),ve([]),Ne(""),le(""),ae(!1),z(""),ot(S.platform_user_id)):B("Failed to publish carousel: "+(s.error||"Unknown error"))}catch(e){B("Error publishing carousel: "+(e.message||e.toString()))}finally{G(!1)}}else B("Please provide a prompt for auto-generating caption.");else B("Please write a caption or enable auto-generate caption.");else B("Please select an Instagram account first.")},disabled:U||xe.length<3||!we.trim()&&!te,children:U?"Publishing...":"Publish Carousel"})]}),"reel"===$&&(0,c.jsxs)("div",{className:"post-card",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Upload Reel Video (.mp4, .mov)"}),(0,c.jsxs)("div",{className:"file-input-wrapper",children:[(0,c.jsx)("input",{type:"file",accept:"video/mp4,video/quicktime,.mp4,.mov",onChange:ut,disabled:Ue,id:"reel-video-input",style:{display:"none"}}),(0,c.jsxs)("label",{htmlFor:"reel-video-input",className:"file-picker-button",style:{opacity:Ue?.6:1,cursor:Ue?"not-allowed":"pointer"},children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,c.jsx)("polyline",{points:"7,10 12,15 17,10"}),(0,c.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),Ue?"Uploading...":"Choose Video File"]})]}),De&&(0,c.jsx)("div",{className:"video-preview",children:(0,c.jsx)("video",{src:De,controls:!0,style:{width:"100%",maxHeight:"300px"}})})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Upload Reel Thumbnail (optional):"}),(0,c.jsxs)("div",{className:"file-input-wrapper",children:[(0,c.jsx)("input",{type:"file",accept:"image/png,image/jpeg,image/jpg",onChange:async e=>{const s=e.target.files[0];if(s)if(g.includes(s.type)){B("Uploading thumbnail image...");try{var t;const e=await l.A.uploadThumbnailToCloudinary(s);if(!(e&&e.success&&(e.url||null!==(t=e.data)&&void 0!==t&&t.url)))throw new Error((null===e||void 0===e?void 0:e.error)||(null===e||void 0===e?void 0:e.message)||"Thumbnail upload failed");{var a,i;const t=e.url||(null===(a=e.data)||void 0===a?void 0:a.url),l=e.filename||(null===(i=e.data)||void 0===i?void 0:i.filename);He(t),Ye(l||""),Ve(s),console.log("\ud83d\udd0d DEBUG: Thumbnail uploaded successfully:",{imageUrl:t,filename:l,res:e}),B("Thumbnail uploaded successfully!")}}catch(o){B("Error: "+(o.message||o.toString()))}}else B("Only .jpg, .jpeg, .png files are allowed for thumbnail.")},disabled:!De,id:"reel-thumbnail-input",style:{display:"none"}}),(0,c.jsxs)("label",{htmlFor:"reel-thumbnail-input",className:"file-picker-button",style:{opacity:De?1:.6,cursor:De?"pointer":"not-allowed"},children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,c.jsx)("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),(0,c.jsx)("polyline",{points:"21,15 16,10 5,21"})]}),"Choose Thumbnail"]})]}),qe&&(0,c.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:8},children:[(0,c.jsx)("img",{src:qe,alt:"Reel Thumbnail Preview",style:{maxWidth:120,borderRadius:8,border:"1px solid #eee"}}),(0,c.jsx)("button",{type:"button",onClick:()=>{He(""),Ye(""),Ve(null)},style:{background:"transparent",border:"1px solid #e53e3e",cursor:"pointer",color:"#e53e3e",fontSize:18,borderRadius:"4px",width:"28px",height:"28px",display:"flex",alignItems:"center",justifyContent:"center"},title:"Remove thumbnail",children:"\xd7"})]})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Caption"}),(0,c.jsxs)("div",{className:"caption-section",children:[(0,c.jsx)("div",{className:"caption-toggle",children:(0,c.jsxs)("label",{className:"toggle-label",children:[(0,c.jsx)("input",{type:"checkbox",checked:$e,onChange:e=>Re(e.target.checked)}),(0,c.jsx)("span",{className:"toggle-text",children:"Auto Generate Caption"})]})}),$e?(0,c.jsxs)("div",{className:"caption-prompt-section",children:[(0,c.jsx)("textarea",{value:We,onChange:e=>Me(e.target.value),placeholder:"Describe what you want in the caption...",rows:2,className:"caption-prompt-textarea"}),(0,c.jsx)("button",{onClick:async()=>{if(We.trim()){ze(!0),B("Generating reel caption...");try{const e=await l.A.generateInstagramCaption(We.trim());e.success&&e.content?(Be(e.content),B("Reel caption generated successfully!")):B("Failed to generate caption: "+(e.error||"Unknown error"))}catch(e){B("Error generating caption: "+e.message)}finally{ze(!1)}}else B("Please provide a prompt for caption generation.")},disabled:Le||!We.trim(),className:"generate-caption-button",children:Le?"Generating...":"Generate Caption"})]}):null,(0,c.jsx)("textarea",{value:Te,onChange:e=>Be(e.target.value),placeholder:$e&&!Te?"Caption will be generated...":"Write your caption...",rows:3,className:"post-textarea",disabled:$e&&!Te})]})]}),(0,c.jsx)("button",{className:"publish-button",onClick:bt,disabled:U||!De||!Te.trim()&&!$e,children:U?"Publishing...":"Publish Reel"})]})]}),"media"===_&&S&&(0,c.jsxs)("div",{className:"media-section",children:[(0,c.jsxs)("div",{className:"media-header",children:[(0,c.jsx)("h2",{children:"Recent Posts"}),(0,c.jsx)("p",{children:"Your latest Instagram content"})]}),Ze?(0,c.jsxs)("div",{className:"loading-media",children:[(0,c.jsx)("div",{className:"loading-spinner"}),(0,c.jsx)("p",{children:"Loading media..."})]}):Je.length>0?(0,c.jsx)("div",{className:"media-grid",children:Je.slice(0,12).map(e=>(0,c.jsxs)("div",{className:"media-item",children:[(0,c.jsx)("div",{className:"media-content",children:"IMAGE"===e.media_type?(0,c.jsx)("img",{src:e.media_url,alt:"Instagram post"}):"VIDEO"===e.media_type?(0,c.jsx)("video",{controls:!0,children:(0,c.jsx)("source",{src:e.media_url,type:"video/mp4"})}):null}),(0,c.jsx)("div",{className:"media-overlay",children:(0,c.jsxs)("div",{className:"media-info",children:[(0,c.jsx)("p",{className:"media-caption",children:e.caption?e.caption.substring(0,100)+"...":"No caption"}),(0,c.jsx)("p",{className:"media-date",children:new Date(e.timestamp).toLocaleDateString()})]})})]},e.id))}):(0,c.jsxs)("div",{className:"no-media",children:[(0,c.jsx)("h3",{children:"No Media Found"}),(0,c.jsx)("p",{children:"No media found for this account. Start creating posts to see them here!"})]})]}),"bulk-composer"===_&&S&&(0,c.jsx)(d,{selectedAccount:S,onClose:()=>{}}),"scheduled-posts"===_&&(0,c.jsx)(m,{})]})]}),es&&(0,c.jsx)("div",{className:"modal-overlay",onClick:()=>ss(!1),children:(0,c.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[(0,c.jsxs)("div",{className:"modal-header",children:[(0,c.jsx)("h3",{children:"Select from Google Drive"}),(0,c.jsx)("button",{onClick:()=>ss(!1),className:"modal-close",children:"\xd7"})]}),(0,c.jsx)("div",{className:"modal-body",children:os?(0,c.jsx)("div",{className:"drive-files",children:is?(0,c.jsxs)("div",{className:"loading-files",children:[(0,c.jsx)("div",{className:"loading-spinner"}),(0,c.jsx)("p",{children:"Loading files..."})]}):ts.length>0?(0,c.jsx)("div",{className:"files-grid",children:ts.map(e=>(0,c.jsxs)("div",{className:"file-item",onClick:()=>(async(e,s)=>{X(!0),B("Downloading file from Google Drive...");try{const t=await l.A.downloadGoogleDriveFile(e);if(!t.success||!t.fileContent)throw new Error(t.error||"Download failed");{const e=atob(t.fileContent),a=new Array(e.length);for(let s=0;s<e.length;s++)a[s]=e.charCodeAt(s);const i=new Uint8Array(a),o=new Blob([i],{type:t.mimeType}),n=new File([o],s,{type:t.mimeType}),r=await l.A.uploadImageToCloudinary(n);if(!(r.success&&r.data&&r.data.url))throw new Error(r.error||"Upload failed");Q(r.data.url),H(r.data.url),B("File uploaded from Google Drive successfully!"),ss(!1)}}catch(t){B(`Error processing Google Drive file: ${t.message}`)}finally{X(!1)}})(e.id,e.name),children:[e.thumbnailLink?(0,c.jsx)("img",{src:e.thumbnailLink,alt:e.name,className:"file-thumbnail"}):(0,c.jsx)("div",{className:"file-icon"}),(0,c.jsxs)("div",{className:"file-info",children:[(0,c.jsx)("p",{className:"file-name",children:e.name}),(0,c.jsx)("p",{className:"file-size",children:e.size?`${Math.round(e.size/1024)} KB`:"Unknown size"})]})]},e.id))}):(0,c.jsx)("div",{className:"no-files",children:(0,c.jsx)("p",{children:"No image files found in Google Drive"})})}):(0,c.jsxs)("div",{className:"drive-auth",children:[(0,c.jsx)("p",{children:"Connect to Google Drive to select files"}),(0,c.jsx)("button",{onClick:mt,disabled:rs,className:"auth-button",children:rs?"Connecting...":"Connect Google Drive"})]})})]})}),Ds&&(0,c.jsx)("div",{className:"modal-overlay",onClick:pt,children:(0,c.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[(0,c.jsxs)("div",{className:"modal-header",children:[(0,c.jsxs)("h3",{children:["Select ","photo"===Fs?"Photo":"Video"]}),(0,c.jsx)("button",{onClick:pt,className:"modal-close",children:(0,c.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,c.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,c.jsxs)("div",{className:"modal-body",children:[(0,c.jsxs)("div",{className:"file-picker-options",children:[(0,c.jsxs)("div",{className:"file-option",onClick:()=>document.getElementById("local-file-input").click(),onTouchStart:e=>e.preventDefault(),children:[(0,c.jsx)("div",{className:"file-option-icon",children:(0,c.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,c.jsx)("polyline",{points:"7,10 12,15 17,10"}),(0,c.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]})}),(0,c.jsxs)("div",{className:"file-option-content",children:[(0,c.jsx)("h4",{children:"From Device"}),(0,c.jsx)("p",{children:"Select a file from your computer"})]})]}),(0,c.jsxs)("div",{className:"file-option "+($s?"":"disabled"),onClick:xt,onTouchStart:e=>{$s?(e.preventDefault(),xt()):e.preventDefault()},children:[(0,c.jsx)("div",{className:"file-option-icon",children:(0,c.jsx)("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,c.jsx)("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})})}),(0,c.jsxs)("div",{className:"file-option-content",children:[(0,c.jsx)("h4",{children:"From Google Drive"}),(0,c.jsx)("p",{children:$s?"Select a file from your Google Drive":"Google Drive not configured. See setup guide."}),Us&&(0,c.jsxs)("div",{className:"loading-indicator",children:[(0,c.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,c.jsx)("path",{d:"M21 12a9 9 0 11-6.219-8.56"})}),"Loading..."]}),!$s&&(0,c.jsxs)("div",{className:"unavailable-indicator",children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,c.jsx)("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),(0,c.jsx)("line",{x1:"9",y1:"9",x2:"15",y2:"15"})]}),"Not Available"]})]})]})]}),(0,c.jsx)("input",{id:"local-file-input",type:"file",accept:"photo"===Fs?"image/*":"video/*",multiple:"carousel"===Ts,onChange:e=>{const s=Array.from(e.target.files);if(0!==s.length){if("carousel"===Ts)rt({target:{files:s}});else{const e=s[0];"photo"===Fs?nt({target:{files:[e]}}):"video"===Fs&&ut({target:{files:[e]}})}pt()}},style:{display:"none"}})]})]})}),zs&&Ys&&(0,c.jsxs)("div",{className:"auto-reply-progress",style:{margin:"16px 0",padding:"12px",background:"#f5f5f5",borderRadius:"8px"},children:[(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Auto-Reply Progress:"})," ",Ys.status]}),"processing"===Ys.status&&(0,c.jsxs)("p",{children:["Processing post ",Ys.current_post," of ",Ys.total_posts,", comment ",Ys.current_comment," of ",Ys.total_comments]}),"done"===Ys.status&&(0,c.jsx)("p",{children:"All comments processed!"}),Ys.details&&(0,c.jsx)("p",{children:Ys.details})]}),Qs&&(0,c.jsxs)("div",{className:"api-error",style:{color:"red",margin:"12px 0"},children:[(0,c.jsxs)("p",{children:["Error: ",Qs]}),(0,c.jsx)("button",{onClick:()=>{Zs(null),et(!0),setTimeout(()=>{et(!1),window.location.reload()},500)},children:"Retry"}),Xs&&(0,c.jsx)("span",{children:"Retrying..."})]})]}):(0,c.jsx)("div",{className:"instagram-container",children:(0,c.jsxs)("div",{className:"loading-screen",children:[(0,c.jsx)("div",{className:"loading-spinner"}),(0,c.jsx)("p",{children:"Loading Instagram SDK..."})]})}):(0,c.jsxs)("div",{className:"instagram-container",children:[(0,c.jsxs)("div",{className:"header-section",children:[(0,c.jsx)("button",{onClick:()=>e("/"),className:"back-button",children:"Back to Dashboard"}),(0,c.jsx)("h1",{style:"position: left",children:"Instagram Management"}),(0,c.jsx)("p",{children:"Please log in to your account to connect and manage Instagram."})]}),(0,c.jsxs)("div",{className:"auth-required",children:[(0,c.jsx)("div",{className:"auth-icon"}),(0,c.jsx)("h2",{children:"Authentication Required"}),(0,c.jsx)("p",{children:"You need to be logged in to use Instagram features. Please log in first."})]})]})}},860:(e,s,t)=>{t.d(s,{bB:()=>a,xV:()=>i});t(579);const a=e=>new Promise((s,t)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>s(a.result),a.onerror=e=>t(e)}),i=e=>new Promise((s,t)=>{(()=>{try{if(window.FB){try{window.FB.getLoginStatus&&window.FB.logout()}catch(e){}delete window.FB}window.fbAsyncInit&&delete window.fbAsyncInit}catch(e){}})();const a=["v21.0","v20.0","v19.0","v18.0"];let i=0;const l=()=>{const o=a[i];if(window.fbAsyncInit=function(){try{window.FB.init({appId:e,cookie:!0,xfbml:!0,version:o,status:!0}),console.log(`Facebook SDK initialized successfully with ${o}`),window.FB.getLoginStatus(function(e){console.log("Facebook SDK test successful:",e.status),s()},!0)}catch(n){console.error(`Facebook SDK initialization failed with ${o}:`,n),i++,i<a.length?(console.log(`Trying Facebook SDK version ${a[i]}...`),setTimeout(l,500)):t(new Error("All Facebook SDK versions failed to initialize"))}},!document.getElementById("facebook-jssdk")){const e=document.createElement("script");e.id="facebook-jssdk",e.src="https://connect.facebook.net/en_US/sdk.js",e.async=!0,e.defer=!0,e.crossOrigin="anonymous",e.onerror=()=>{console.error(`Failed to load Facebook SDK script for ${o}`),i++,i<a.length?(console.log(`Trying Facebook SDK version ${a[i]}...`),setTimeout(l,500)):t(new Error("Failed to load Facebook SDK script"))},document.body.appendChild(e)}};l()})}}]);
//# sourceMappingURL=732.9256fbba.chunk.js.map